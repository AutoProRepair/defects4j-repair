# Math - Brutpol angelic condition repair


- Nb patch found: 31/106

| #Bug | Nb Statements Analyzed | Nb Angelic Value Found | Exec. time | Patch Found |
|------|---------------|--------------|------------|------------|
| 1 | NONE | NONE | > 6h | NO |
| 2 | NONE | NONE | > 6h | NO |
| 3 | NONE | NONE | > 6h | NO |
| 4 | NONE | NONE | > 6h | NO |
| 5 | NONE | NONE | > 6h | NO |
| 6 | NONE | NONE | > 6h | NO |
| 7 | NONE | NONE | > 6h | NO |
| 8 | NONE | NONE | > 6h | NO |
| 9 | NONE | NONE | > 6h | NO |
| 10 | NONE | NONE | > 6h | NO |
| 11 | NONE | NONE | > 6h | NO |
| 12 | NONE | NONE | > 6h | NO |
| 13 | NONE | NONE | > 6h | NO |
| 14 | NONE | NONE | > 6h | NO |
| 15 | NONE | NONE | > 6h | NO |
| 16 | NONE | NONE | > 6h | NO |
| 17 | NONE | NONE | > 6h | NO |
| 18 | NONE | NONE | > 6h | NO |
| 19 | NONE | NONE | > 6h | NO |
| 20 | NONE | NONE | > 6h | NO |
| 21 | NONE | NONE | > 6h | NO |
| 22 | NONE | NONE | > 6h | NO |
| 23 | NONE | NONE | > 6h | NO |
| 24 | NONE | NONE | > 6h | NO |
| 25 | NONE | NONE | > 6h | NO |
| 26 | NONE | NONE | > 6h | NO |
| 27 | NONE | NONE | > 6h | NO |
| 28 | NONE | NONE | > 6h | NO |
| 29 | NONE | NONE | > 6h | NO |
| 30 | NONE | NONE | > 6h | NO |
| 31 | NONE | NONE | > 6h | NO |
| 32 | NONE | NONE | > 6h | NO |
| 33 | NONE | NONE | > 6h | NO |
| 34 | NONE | NONE | > 6h | NO |
| 35 | NONE | NONE | > 6h | NO |
| 36 | NONE | NONE | > 6h | NO |
| 37 | NONE | NONE | > 6h | NO |
| 38 | NONE | NONE | > 6h | NO |
| 39 | NONE | NONE | > 6h | NO |
| 40 | NONE | NONE | > 6h | NO |
| 41 | NONE | NONE | > 6h | NO |
| 42 | NONE | NONE | > 6h | NO |
| 43 | NONE | NONE | > 6h | NO |
| 44 | NONE | NONE | > 6h | NO |
| 45 | NONE | NONE | > 6h | NO |
| 46 | NONE | NONE | > 6h | NO |
| 47 | NONE | NONE | > 6h | NO |
| 48 | NONE | NONE | > 6h | NO |
| 49 | NONE | NONE | > 6h | NO |
| 50 | NONE | NONE | > 6h | NO |
| 51 |  149 |  0 |  245661ms | NO |
| 52 | NONE | NONE | > 6h | NO |
| 53 |  14 |  0 |  129030ms | NO |
| 54 | NONE | NONE | > 6h | NO |
| 55 |  9 |  0 |  126427ms | NO |
| 56 |  68 |  0 |  131933ms | NO |
| 57 |  72 |  1 |  410163ms | NO |
| 58 | NONE | NONE | > 6h | NO |
| 59 |  222 |  0 |  88392ms | NO |
| 60 | NONE | NONE | > 6h | NO |
| 61 |  56 |  0 |  42057ms | NO |
| 62 |  178 |  0 |  53942ms | NO |
| 63 |  9 |  0 |  31052ms | NO |
| 64 |  437 |  0 |  1213425ms | NO |
| 65 |  420 |  0 |  63986ms | NO |
| 66 |  378 |  0 |  52950ms | NO |
| 67 |  177 |  0 |  37843ms | NO |
| 68 |  428 |  0 |  1068811ms | NO |
| 69 |  107 |  1 |  157555ms | YES |
| 70 |  31 |  0 |  27170ms | NO |
| 71 |  3 |  1 |  24759ms | YES |
| 72 |  5 |  1 |  77522ms | YES |
| 73 |  5 |  1 |  77143ms | YES |
| 74 |  5 |  1 |  90839ms | YES |
| 75 |  5 |  1 |  102484ms | YES |
| 76 |  5 |  1 |  87456ms | YES |
| 77 |  5 |  1 |  94521ms | YES |
| 78 |  5 |  1 |  83322ms | YES |
| 79 |  5 |  1 |  82775ms | YES |
| 80 |  5 |  1 |  95550ms | YES |
| 81 |  5 |  1 |  85986ms | YES |
| 82 |  5 |  1 |  78028ms | YES |
| 83 |  5 |  1 |  77933ms | YES |
| 84 |  5 |  1 |  90360ms | YES |
| 85 |  5 |  1 |  86297ms | YES |
| 86 |  5 |  1 |  74684ms | YES |
| 87 |  5 |  1 |  75786ms | YES |
| 88 |  5 |  1 |  84846ms | YES |
| 89 |  5 |  1 |  83314ms | YES |
| 90 |  5 |  1 |  87716ms | YES |
| 91 |  5 |  1 |  34890ms | YES |
| 92 |  5 |  1 |  20090ms | YES |
| 93 |  5 |  1 |  21016ms | YES |
| 94 |  3 |  1 |  18596ms | YES |
| 95 |  4 |  1 |  16546ms | YES |
| 96 |  4 |  1 |  16391ms | YES |
| 97 |  4 |  1 |  15451ms | YES |
| 98 |  4 |  1 |  16022ms | YES |
| 99 |  4 |  1 |  15764ms | YES |
| 100 |  4 |  1 |  15589ms | YES |
| 101 | NONE | NONE | > 6h | NO |
| 102 | NONE | NONE | > 6h | NO |
| 103 | NONE | NONE | > 6h | NO |
| 104 | NONE | NONE | > 6h | NO |
| 105 | NONE | NONE | > 6h | NO |
| 106 | NONE | NONE | > 6h | NO |
## Patches

### Bug 69

- Ranking nopol: 107

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 107
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 157555ms
----PATCH FOUND----
org.apache.commons.math.distribution.TDistributionImpl:128: CONDITIONAL (this.density(x) / this.solverAbsoluteAccuracy) < (this.solverAbsoluteAccuracy / x)
```

- IRL patch:

```
org.apache.commons.math.stat.correlation.PearsonsCorrelation

171c171
<                     out[i][j] = 2 * (1 - tDistribution.cumulativeProbability(t));
---
>                     out[i][j] = 2 * tDistribution.cumulativeProbability(-t);


```

### Bug 71

- Ranking nopol: 3

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 3
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 24759ms
----PATCH FOUND----
org.apache.commons.math.ode.nonstiff.AdaptiveStepsizeIntegrator:150: CONDITIONAL this.stepSize <= initialStepSize
```

- IRL patch:

```
org.apache.commons.math.ode.nonstiff.AdamsMoultonIntegrator

292c292,300
<                             // rejecting the step would lead to a too small next step, we accept it
---
>                             // we cannot simply truncate the step, reject the current computation
>                             // and let the loop compute another state with the truncated step.
>                             // it is so small (much probably exactly 0 due to limited accuracy)
>                             // that the code above would fail handling it.
>                             // So we set up an artificial 0 size step by copying states
>                             interpolator.storeTime(stepStart);
>                             System.arraycopy(y, 0, yTmp, 0, y0.length);
>                             hNew     = 0;
>                             stepSize = 0;


org.apache.commons.math.ode.nonstiff.EmbeddedRungeKuttaIntegrator

295c295,303
<                   // rejecting the step would lead to a too small next step, we accept it
---
>                   // we cannot simply truncate the step, reject the current computation
>                   // and let the loop compute another state with the truncated step.
>                   // it is so small (much probably exactly 0 due to limited accuracy)
>                   // that the code above would fail handling it.
>                   // So we set up an artificial 0 size step by copying states
>                   interpolator.storeTime(stepStart);
>                   System.arraycopy(y, 0, yTmp, 0, y0.length);
>                   hNew     = 0;
>                   stepSize = 0;


org.apache.commons.math.ode.nonstiff.RungeKuttaIntegrator

175c175,182
<                 // rejecting the step would lead to a too small next step, we accept it
---
>                 // we cannot simply truncate the step, reject the current computation
>                 // and let the loop compute another state with the truncated step.
>                 // it is so small (much probably exactly 0 due to limited accuracy)
>                 // that the code above would fail handling it.
>                 // So we set up an artificial 0 size step by copying states
>                 interpolator.storeTime(stepStart);
>                 System.arraycopy(y, 0, yTmp, 0, y0.length);
>                 stepSize = 0;


org.apache.commons.math.ode.nonstiff.AdamsBashforthIntegrator

274c274,282
<                             // rejecting the step would lead to a too small next step, we accept it
---
>                             // we cannot simply truncate the step, reject the current computation
>                             // and let the loop compute another state with the truncated step.
>                             // it is so small (much probably exactly 0 due to limited accuracy)
>                             // that the code above would fail handling it.
>                             // So we set up an artificial 0 size step by copying states
>                             interpolator.storeTime(stepStart);
>                             System.arraycopy(y, 0, yTmp, 0, y0.length);
>                             hNew     = 0;
>                             stepSize = 0;


```

### Bug 72

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 77522ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BrentSolver

115c115
<             setResult(yMin, 0);
---
>             setResult(min, 0);
127c127
<             setResult(yMax, 0);
---
>             setResult(max, 0);


```

### Bug 73

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 77143ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BrentSolver

34a35,39
>     /** Error message for non-bracketing interval. */
>     private static final String NON_BRACKETING_MESSAGE =
>         "function values at endpoints do not have different signs.  " +
>         "Endpoints: [{0}, {1}], Values: [{2}, {3}]";
> 
130a136,140
>         if (yMin * yMax > 0) {
>             throw MathRuntimeException.createIllegalArgumentException(
>                   NON_BRACKETING_MESSAGE, min, max, yMin, yMax);
>         }
> 
179,181c189
<                         "function values at endpoints do not have different signs.  " +
<                         "Endpoints: [{0}, {1}], Values: [{2}, {3}]",
<                         min, max, yMin, yMax);
---
>                         NON_BRACKETING_MESSAGE, min, max, yMin, yMax);


```

### Bug 74

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 90839ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.ode.nonstiff.EmbeddedRungeKuttaIntegrator

20,21d19
< import java.util.Arrays;
< 
247,249c245,249
<           final double[] scale;
<           if (vecAbsoluteTolerance != null) {
<             scale = vecAbsoluteTolerance;
---
>           final double[] scale = new double[y0.length];
>           if (vecAbsoluteTolerance == null) {
>               for (int i = 0; i < scale.length; ++i) {
>                 scale[i] = scalAbsoluteTolerance + scalRelativeTolerance * Math.abs(y[i]);
>               }
251,252c251,253
<             scale = new double[y0.length];
<             Arrays.fill(scale, scalAbsoluteTolerance);
---
>               for (int i = 0; i < scale.length; ++i) {
>                 scale[i] = vecAbsoluteTolerance[i] + vecRelativeTolerance[i] * Math.abs(y[i]);
>               }


```

### Bug 75

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 102484ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.stat.Frequency

303c303
<         return getCumPct((Comparable<?>) v);
---
>         return getPct((Comparable<?>) v);


```

### Bug 76

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 87456ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.linear.SingularValueDecompositionImpl

162c162
<                     eigenDecomposition.getV().getSubMatrix(0, p - 1, 0, p - 1);
---
>                     eigenDecomposition.getV().getSubMatrix(0, n - 1, 0, p - 1);
166c166
<                 for (int i = 0; i < p - 1; ++i) {
---
>                 for (int i = 0; i < p; ++i) {
169d168
<                     final double si = secondaryBidiagonal[i];
171a171
>                     if (i < n - 1) {
172a173
>                         final double si = secondaryBidiagonal[i];
176,179c177
<                 }
<                 // last row
<                 final double lastMain = mainBidiagonal[p - 1];
<                 final double[] wr1  = wData[p - 1];
---
>                     } else {
181c179,180
<                     wr1[j] = ei1[j] * lastMain / singularValues[j];
---
>                             wi[j] = mi * ei0[j] / singularValues[j];
>                         }
182a182,183
>                 }
> 
250c251
<                     eigenDecomposition.getV().getSubMatrix(0, p - 1, 0, p - 1);
---
>                     eigenDecomposition.getV().getSubMatrix(0, m - 1, 0, p - 1);
254c255
<                 for (int i = 0; i < p - 1; ++i) {
---
>                 for (int i = 0; i < p; ++i) {
256d256
<                     final double si = secondaryBidiagonal[i];
258a259
>                     if (i < m - 1) {
259a261
>                         final double si = secondaryBidiagonal[i];
263,266c265
<                 }
<                 // last row
<                 final double lastMain = mainBidiagonal[p - 1];
<                 final double[] wr1  = wData[p - 1];
---
>                     } else {
268c267,269
<                     wr1[j] = ei1[j] * lastMain / singularValues[j];
---
>                             wi[j] = mi * ei0[j] / singularValues[j];
>                         }
>                     }


```

### Bug 77

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 94521ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.linear.AbstractRealVector

208a209,242
>     public double getNorm() {
>         double sum = 0;
>         Iterator<Entry> it = sparseIterator();
>         Entry e;
>         while (it.hasNext() && (e = it.next()) != null) {
>             final double value = e.getValue();
>             sum += value * value;
>         }
>         return Math.sqrt(sum);
>     }
> 
>     /** {@inheritDoc} */
>     public double getL1Norm() {
>         double norm = 0;
>         Iterator<Entry> it = sparseIterator();
>         Entry e;
>         while (it.hasNext() && (e = it.next()) != null) {
>             norm += Math.abs(e.getValue());
>         }
>         return norm;
>     }
> 
>     /** {@inheritDoc} */
>     public double getLInfNorm() {
>         double norm = 0;
>         Iterator<Entry> it = sparseIterator();
>         Entry e;
>         while (it.hasNext() && (e = it.next()) != null) {
>             norm = Math.max(norm, Math.abs(e.getValue()));
>         }
>         return norm;
>     }
> 
>     /** {@inheritDoc} */


org.apache.commons.math.linear.OpenMapRealVector

498,508d497
<     /** {@inheritDoc} */
<     public double getL1Norm() {
<         double res = 0;
<         Iterator iter = entries.iterator();
<         while (iter.hasNext()) {
<             iter.advance();
<             res += Math.abs(iter.value());
<         }
<         return res;
<     }
< 
560,581d548
<     public double getLInfNorm() {
<         double max = 0;
<         Iterator iter = entries.iterator();
<         while (iter.hasNext()) {
<             iter.advance();
<             max += iter.value();
<         }
<         return max;
<     }
< 
<     /** {@inheritDoc} */
<     public double getNorm() {
<         double res = 0;
<         Iterator iter = entries.iterator();
<         while (iter.hasNext()) {
<             iter.advance();
<             res += iter.value() * iter.value();
<         }
<         return Math.sqrt(res);
<     }
< 
<     /** {@inheritDoc} */


org.apache.commons.math.linear.ArrayRealVector

696a697
>     @Override
705a707
>     @Override
714a717
>     @Override
718c721
<             max += Math.max(max, Math.abs(a));
---
>             max = Math.max(max, Math.abs(a));


```

### Bug 78

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 83322ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:173: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.ode.events.EventState

190a191,210
>                     if (ga * gb > 0) {
>                         // this is a corner case:
>                         // - there was an event near ta,
>                         // - there is another event between ta and tb
>                         // - when ta was computed, convergence was reached on the "wrong side" of the interval
>                         // this implies that the real sign of ga is the same as gb, so we need to slightly
>                         // shift ta to make sure ga and gb get opposite signs and the solver won't complain
>                         // about bracketing
>                         final double epsilon = (forward ? 0.25 : -0.25) * convergence;
>                         for (int k = 0; (k < 4) && (ga * gb > 0); ++k) {
>                             ta += epsilon;
>                             interpolator.setInterpolatedTime(ta);
>                             ga = handler.g(ta, interpolator.getInterpolatedState());
>                         }
>                         if (ga * gb > 0) {
>                             // this should never happen
>                             throw MathRuntimeException.createInternalError(null);
>                         }
>                     }
>                          
209,218c229,231
<                     double root;
<                     try {
<                         root = (ta <= tb) ? solver.solve(f, ta, tb) : solver.solve(f, tb, ta);
<                     } catch (IllegalArgumentException iae) {
<                         // the interval did not really bracket a root
<                         root = Double.NaN;
<                     }
<                     if (Double.isNaN(root) ||
<                         ((Math.abs(root - ta) <= convergence) &&
<                          (Math.abs(root - previousEventTime) <= convergence))) {
---
>                     final double root = (ta <= tb) ? solver.solve(f, ta, tb) : solver.solve(f, tb, ta);
>                     if ((Math.abs(root - ta) <= convergence) &&
>                          (Math.abs(root - previousEventTime) <= convergence)) {


```

### Bug 79

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 82775ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:164: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.util.MathUtils

1624c1624
<       int sum = 0;
---
>       double sum = 0;
1626c1626
<           final int dp = p1[i] - p2[i];
---
>           final double dp = p1[i] - p2[i];


```

### Bug 80

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 95550ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:164: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

1135c1135
<             int j = 4 * n - 1;
---
>             int j = 4 * (n - 1);


```

### Bug 81

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 85986ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:164: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

598,599c598,603
<         work[lowerStart + m - 1] = dCurrent - eCurrent;
<         work[upperStart + m - 1] = dCurrent + eCurrent;
---
>         final double lower = dCurrent - eCurrent;
>         work[lowerStart + m - 1] = lower;
>         lowerSpectra = Math.min(lowerSpectra, lower);
>         final double upper = dCurrent + eCurrent;
>         work[upperStart + m - 1] = upper;
>         upperSpectra = Math.max(upperSpectra, upper);
902,903c906,907
<                     for (int i = 4 * i0; i < 4 * n0 - 11; i += 4) {
<                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) &&
---
>                     for (int i = 4 * i0; i < 4 * n0 - 16; i += 4) {
>                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) ||
1540c1544
<                 if (end - start > 2) {
---
>                 if (end - start > 3) {


```

### Bug 82

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 78028ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:158: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexSolver

80,82c80,83
<             double rhs = tableau.getEntry(i, tableau.getWidth() - 1);
<             if (MathUtils.compareTo(tableau.getEntry(i, col), 0, epsilon) >= 0) {
<                 double ratio = rhs / tableau.getEntry(i, col);
---
>             final double rhs = tableau.getEntry(i, tableau.getWidth() - 1);
>             final double entry = tableau.getEntry(i, col);
>             if (MathUtils.compareTo(entry, 0, epsilon) > 0) {
>                 final double ratio = rhs / entry;


```

### Bug 83

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 77933ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:158: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

292c292,293
<         for (int i = getNumObjectiveFunctions(); i < getHeight(); i++) {
---
>         int start = ignoreObjectiveRows ? getNumObjectiveFunctions() : 0;
>         for (int i = start; i < getHeight(); i++) {
340,341c341,342
<       Integer basicRow = getBasicRow(getNumObjectiveFunctions() + getOriginalNumDecisionVariables());
<       double mostNegative = basicRow == null ? 0 : getEntry(basicRow, getRhsOffset());
---
>       Integer negativeVarBasicRow = getBasicRowForSolution(getNegativeDecisionVariableOffset());
>       double mostNegative = negativeVarBasicRow == null ? 0 : getEntry(negativeVarBasicRow, getRhsOffset());
344c345
<            basicRow = getBasicRow(getNumObjectiveFunctions() + i);
---
>           Integer basicRow = getBasicRowForSolution(getNumObjectiveFunctions() + i);


```

### Bug 84

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 90360ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:158: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.optimization.direct.MultiDirectional

63a64
>         final RealConvergenceChecker checker = getConvergenceChecker();
94a96,105
>             // check convergence
>             final int iter = getIterations();
>             boolean converged = true;
>             for (int i = 0; i < simplex.length; ++i) {
>                 converged &= checker.converged(iter, original[i], simplex[i]);
>             }
>             if (converged) {
>                 return;
>             }
> 


```

### Bug 85

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 86297ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:158: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.UnivariateRealSolverUtils

198c198
<         if (fa * fb >= 0.0 ) {
---
>         if (fa * fb > 0.0 ) {


```

### Bug 86

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 74684ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.linear.CholeskyDecompositionImpl

114,118d113
<             // check diagonal element
<             if (lTData[i][i] < absolutePositivityThreshold) {
<                 throw new NotPositiveDefiniteMatrixException();
<             }
< 
136a132,137
> 
>             // check diagonal element
>             if (ltI[i] < absolutePositivityThreshold) {
>                 throw new NotPositiveDefiniteMatrixException();
>             }
> 


```

### Bug 87

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 75786ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

275,276c275
<             if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
<                 if (row == null) {
---
>             if (MathUtils.equals(getEntry(i, col), 1.0, epsilon) && (row == null)) {
278c277
<                 } else {
---
>             } else if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
282d280
<         }


```

### Bug 88

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 84846ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

326c326,329
<         double mostNegative = getDecisionVariableValue(getOriginalNumDecisionVariables());
---
>         Integer basicRow =
>             getBasicRow(getNumObjectiveFunctions() + getOriginalNumDecisionVariables());
>         double mostNegative = basicRow == null ? 0 : getEntry(basicRow, getRhsOffset());
>         Set<Integer> basicRows = new HashSet<Integer>();
327a331,337
>             basicRow = getBasicRow(getNumObjectiveFunctions() + i);
>             if (basicRows.contains(basicRow)) {
>                 // if multiple variables can take a given value 
>                 // then we choose the first and set the rest equal to 0
>                 coefficients[i] = 0;
>             } else {
>                 basicRows.add(basicRow);
329,352c339,340
<                 getDecisionVariableValue(i) - (restrictToNonNegative ? 0 : mostNegative); 
<         }
<         return new RealPointValuePair(coefficients, f.getValue(coefficients));
<     }
< 
<     /**
<      * Get the value of the given decision variable.  This is not the actual
<      * value as it is guaranteed to be >= 0 and thus must be corrected before
<      * being returned to the user.
<      * 
<      * @param decisionVariable The index of the decision variable
<      * @return The value of the given decision variable.
<      */
<     protected double getDecisionVariableValue(final int decisionVariable) {
<       int col = getNumObjectiveFunctions() + decisionVariable;  
<       Integer basicRow = getBasicRow(col);
<       if (basicRow == null) {
<           return 0;
<       }
<       // if there are multiple variables that can take the value on the RHS
<       // then we'll give the first variable that value
<       for (int i = getNumObjectiveFunctions(); i < col; i++) {
<           if (tableau.getEntry(basicRow, i) == 1) {
<               return 0;
---
>                     (basicRow == null ? 0 : getEntry(basicRow, getRhsOffset())) -
>                     (restrictToNonNegative ? 0 : mostNegative);
355c343
<       return getEntry(basicRow, getRhsOffset()); 
---
>         return new RealPointValuePair(coefficients, f.getValue(coefficients));


```

### Bug 89

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 83314ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.stat.Frequency

104,105c104,105
<      * @throws IllegalArgumentException if <code>v</code> is not comparable with previous entries
<      * @throws ClassCastException if <code>v</code> is not Comparable
---
>      * @throws IllegalArgumentException if <code>v</code> is not Comparable, 
>      *         or is not comparable with previous entries
109a110
>         if (v instanceof Comparable<?>){
110a112,114
>         } else {
>             throw new IllegalArgumentException("Object must implement Comparable");
>         }


```

### Bug 90

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 87716ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.stat.Frequency

104c104,106
<      * @throws IllegalArgumentException if <code>v</code> is not comparable.
---
>      * @throws IllegalArgumentException if <code>v</code> is not comparable with previous entries
>      * @throws ClassCastException if <code>v</code> is not Comparable
>      * @deprecated use {@link #addValue(Comparable)} instead
105a108
>     @Deprecated
106a110,123
>         addValue((Comparable<?>) v);
>     }
>     
>     /**
>      * Adds 1 to the frequency count for v.
>      * <p>
>      * If other objects have already been added to this Frequency, v must
>      * be comparable to those that have already been added.
>      * </p>
>      * 
>      * @param v the value to add.
>      * @throws IllegalArgumentException if <code>v</code> is not comparable with previous entries
>      */
>     public void addValue(Comparable<?>v){


```

### Bug 91

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 34890ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.fraction.Fraction

259,272c259,261
<         int ret = 0;
<         
<         if (this != object) { 
<             double first = doubleValue();
<             double second = object.doubleValue();
<             
<             if (first < second) {
<                 ret = -1;
<             } else if (first > second) {
<                 ret = 1;
<             }
<         }
<         
<         return ret;
---
>         long nOd = ((long) numerator) * object.denominator;
>         long dOn = ((long) denominator) * object.numerator;
>         return (nOd < dOn) ? -1 : ((nOd > dOn) ? +1 : 0);


```

### Bug 92

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 20090ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.util.MathUtils

184,188c184,219
< 
<         long result = Math.round(binomialCoefficientDouble(n, k));
<         if (result == Long.MAX_VALUE) {
<             throw new ArithmeticException(
<                 "result too large to represent in a long integer");
---
>         // Use symmetry for large k
>         if (k > n / 2)
>             return binomialCoefficient(n, n - k);
>         
>         // We use the formula
>         // (n choose k) = n! / (n-k)! / k!
>         // (n choose k) == ((n-k+1)*...*n) / (1*...*k)
>         // which could be written
>         // (n choose k) == (n-1 choose k-1) * n / k
>         long result = 1;
>         if (n <= 61) {
>             // For n <= 61, the naive implementation cannot overflow.
>             for (int j = 1, i = n - k + 1; j <= k; i++, j++) {
>                 result = result * i / j;
>             }
>         } else if (n <= 66) {
>             // For n > 61 but n <= 66, the result cannot overflow,
>             // but we must take care not to overflow intermediate values.
>             for (int j = 1, i = n - k + 1; j <= k; i++, j++) {
>                 // We know that (result * i) is divisible by j,
>                 // but (result * i) may overflow, so we split j:
>                 // Filter out the gcd, d, so j/d and i/d are integer.
>                 // result is divisible by (j/d) because (j/d)
>                 // is relative prime to (i/d) and is a divisor of
>                 // result * (i/d).
>                 long d = gcd(i, j);
>                 result = (result / (j / d)) * (i / d);
>             }
>         } else {
>             // For n > 66, a result overflow might occur, so we check
>             // the multiplication, taking care to not overflow
>             // unnecessary.
>             for (int j = 1, i = n - k + 1; j <= k; i++, j++) {
>                 long d = gcd(i, j);
>                 result = mulAndCheck((result / (j / d)), (i / d));
>             }
216c247,273
<         return Math.floor(Math.exp(binomialCoefficientLog(n, k)) + 0.5);
---
>         if (n < k) {
>             throw new IllegalArgumentException(
>                 "must have n >= k for binomial coefficient (n,k)");
>         }
>         if (n < 0) {
>             throw new IllegalArgumentException(
>                 "must have n >= 0 for binomial coefficient (n,k)");
>         }
>         if ((n == k) || (k == 0)) {
>             return 1d;
>         }
>         if ((k == 1) || (k == n - 1)) {
>             return n;
>         }
>         if (k > n/2) {
>             return binomialCoefficientDouble(n, n - k);
>         }
>         if (n < 67) {
>             return binomialCoefficient(n,k);
>         }
>         
>         double result = 1d;
>         for (int i = 1; i <= k; i++) {
>              result *= (double)(n - k + i) / (double)i;
>         }
>   
>         return Math.floor(result + 0.5);
250c307,315
<             return Math.log((double)n);
---
>             return Math.log((double) n);
>         }
>         
>         /*
>          * For values small enough to do exact integer computation,
>          * return the log of the exact value 
>          */
>         if (n < 67) {  
>             return Math.log(binomialCoefficient(n,k));
251a317,328
>         
>         /*
>          * Return the log of binomialCoefficientDouble for values that will not
>          * overflow binomialCoefficientDouble
>          */
>         if (n < 1030) { 
>             return Math.log(binomialCoefficientDouble(n, k));
>         } 
>         
>         /*
>          * Sum logs for values that could overflow
>          */


```

### Bug 93

- Ranking nopol: 5

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 21016ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.LaguerreSolver:162: CONDITIONAL 0 == (1 + min)
```

- IRL patch:

```
org.apache.commons.math.util.MathUtils

314a315,321
>     /** All long-representable factorials */
>     private static final long[] factorials = new long[] 
>        {1, 1, 2, 6, 24, 120, 720, 5040, 40320, 362880, 3628800, 39916800,
>         479001600, 6227020800l, 87178291200l, 1307674368000l, 20922789888000l,
>         355687428096000l, 6402373705728000l, 121645100408832000l,
>         2432902008176640000l};
> 
338,339c345,348
<         long result = Math.round(factorialDouble(n));
<         if (result == Long.MAX_VALUE) {
---
>         if (n < 0) {
>             throw new IllegalArgumentException("must have n >= 0 for n!");
>         }
>         if (n > 20) {
341c350
<                 "result too large to represent in a long integer");
---
>                     "factorial value is too large to fit in a long");
343c352
<         return result;
---
>         return factorials[n];
369a379,381
>         if (n < 21) {
>             return factorial(n);
>         }
389a402,404
>         if (n < 21) {
>             return Math.log(factorial(n));
>         }


```

### Bug 94

- Ranking nopol: 3

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 3
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 18596ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:220: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.util.MathUtils

412c412
<         if (u * v == 0) {
---
>         if ((u == 0) || (v == 0)) {


```

### Bug 95

- Ranking nopol: 4

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 16546ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:228: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.distribution.FDistributionImpl

144,145c144,150
<         return getDenominatorDegreesOfFreedom() /
<             (getDenominatorDegreesOfFreedom() - 2.0);
---
>         double ret = 1.0;
>         double d = getDenominatorDegreesOfFreedom();
>         if (d > 2.0) {
>             // use mean
>             ret = d / (d - 2.0);
>         }
>         return ret;


```

### Bug 96

- Ranking nopol: 4

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 16391ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:228: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.complex.Complex

258,261c258
<                 ret = (Double.doubleToRawLongBits(real) ==
<                         Double.doubleToRawLongBits(rhs.getReal())) &&
<                     (Double.doubleToRawLongBits(imaginary) ==
<                         Double.doubleToRawLongBits(rhs.getImaginary())); 
---
>                     ret = (real == rhs.real) && (imaginary == rhs.imaginary); 


```

### Bug 97

- Ranking nopol: 4

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 15451ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:228: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 98

- Ranking nopol: 4

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 16022ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:228: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.linear.RealMatrixImpl

779c779
<         final double[] out = new double[v.length];
---
>         final double[] out = new double[nRows];


org.apache.commons.math.linear.BigMatrixImpl

991c991
<         final BigDecimal[] out = new BigDecimal[v.length];
---
>         final BigDecimal[] out = new BigDecimal[nRows];


```

### Bug 99

- Ranking nopol: 4

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 15764ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:228: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 100

- Ranking nopol: 4

- Brutpol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 0
Nb variables in SMT : 0
Nopol Execution time : 15589ms
----PATCH FOUND----
org.apache.commons.math.transform.FastSineTransformer:228: CONDITIONAL f == null
```

- IRL patch:

```
org.apache.commons.math.estimation.AbstractEstimator

166c166
<         final int cols = problem.getAllParameters().length;
---
>         final int cols = problem.getUnboundParameters().length;
202c202
<         int p = problem.getAllParameters().length;
---
>         int p = problem.getUnboundParameters().length;
207c207
<         double[] errors = new double[problem.getAllParameters().length];
---
>         double[] errors = new double[problem.getUnboundParameters().length];


```

