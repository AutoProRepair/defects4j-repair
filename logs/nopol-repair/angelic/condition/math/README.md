# Math - Nopol angelic condition repair


- Nb patch found: 12/106

| #Bug | Nb Statements Analyzed | Nb Angelic Value Found | Exec. time | Patch Found |
|------|---------------|--------------|------------|------------|
| 1 |  145 |  0 |  893760ms | NO |
| 2 | NONE | NONE | > 6h | NO |
| 3 |  21 |  0 |  823659ms | NO |
| 4 |  281 |  0 |  854906ms | NO |
| 5 |  17 |  2 |  2441064ms | NO |
| 6 | NONE | NONE | > 6h | NO |
| 7 | NONE | NONE | > 6h | NO |
| 8 | NONE | NONE | > 6h | NO |
| 9 |  91 |  0 |  1778976ms | NO |
| 10 |  209 |  0 |  9007833ms | NO |
| 11 | NONE | NONE | > 6h | NO |
| 12 | NONE | NONE | > 6h | NO |
| 13 |  87 |  0 |  1724875ms | NO |
| 14 |  102 |  0 |  1806082ms | NO |
| 15 | NONE | NONE | > 6h | NO |
| 16 | NONE | NONE | > 6h | NO |
| 17 | NONE | NONE | > 6h | NO |
| 18 | NONE | NONE | > 6h | NO |
| 19 |  346 |  1 |  1508802ms | NO |
| 20 | NONE | NONE | > 6h | NO |
| 21 |  188 |  0 |  1115696ms | NO |
| 22 | NONE | NONE | > 6h | NO |
| 23 | NONE | NONE | > 6h | NO |
| 24 | NONE | NONE | > 6h | NO |
| 25 |  159 |  0 |  1136432ms | NO |
| 26 | NONE | NONE | > 6h | NO |
| 27 |  32 |  0 |  11908596ms | NO |
| 28 | NONE | NONE | > 6h | NO |
| 29 | NONE | NONE | > 6h | NO |
| 30 |  77 |  1 |  1386670ms | NO |
| 31 | NONE | NONE | > 6h | NO |
| 32 | NONE | NONE | > 6h | NO |
| 33 |  25 |  1 |  1697215ms | YES |
| 34 |  36 |  0 |  989023ms | NO |
| 35 |  21 |  0 |  1040303ms | NO |
| 36 |  17 |  0 |  1018947ms | NO |
| 37 | NONE | NONE | > 6h | NO |
| 38 |  262 |  0 |  745519ms | NO |
| 39 | NONE | NONE | > 6h | NO |
| 40 |  46 |  1 |  1323734ms | YES |
| 41 |  594 |  7 |  9310467ms | NO |
| 42 | NONE | NONE | > 6h | NO |
| 43 |  308 |  1 |  4768403ms | NO |
| 44 | NONE | NONE | > 6h | NO |
| 45 |  27 |  0 |  389678ms | NO |
| 46 |  63 |  2 |  731765ms | NO |
| 47 |  113 |  0 |  4048050ms | NO |
| 48 | NONE | NONE | > 6h | NO |
| 49 |  146 |  3 |  901322ms | NO |
| 50 |  6 |  1 |  2332716ms | YES |
| 51 | NONE | NONE | > 6h | NO |
| 52 |  38 |  1 |  588594ms | YES |
| 53 |  14 |  0 |  278486ms | NO |
| 54 | NONE | NONE | > 6h | NO |
| 55 |  9 |  0 |  306092ms | NO |
| 56 |  68 |  0 |  329197ms | NO |
| 57 |  61 |  1 |  4194419ms | YES |
| 58 |  110 |  1 |  2287719ms | YES |
| 59 | NONE | NONE | > 6h | NO |
| 60 |  196 |  0 |  167239ms | NO |
| 61 |  56 |  0 |  101573ms | NO |
| 62 |  178 |  0 |  127593ms | NO |
| 63 |  9 |  0 |  77203ms | NO |
| 64 |  437 |  0 |  3751684ms | NO |
| 65 |  420 |  0 |  139031ms | NO |
| 66 | NONE | NONE | > 6h | NO |
| 67 | NONE | NONE | > 6h | NO |
| 68 |  428 |  0 |  3738536ms | NO |
| 69 |  268 |  2 |  161602ms | NO |
| 70 |  31 |  0 |  70884ms | NO |
| 71 | NONE | NONE | > 6h | NO |
| 72 |  111 |  0 |  68292ms | NO |
| 73 |  63 |  1 |  94188ms | YES |
| 74 | NONE | NONE | > 6h | NO |
| 75 |  112 |  0 |  81446ms | NO |
| 76 |  517 |  0 |  171224ms | NO |
| 77 |  329 |  0 |  111621ms | NO |
| 78 | NONE | NONE | > 6h | NO |
| 79 |  99 |  1 |  93937ms | NO |
| 80 | NONE | NONE | > 6h | NO |
| 81 |  46 |  1 |  108674ms | YES |
| 82 |  266 |  0 |  93702ms | NO |
| 83 |  291 |  0 |  96159ms | NO |
| 84 |  212 |  0 |  93399ms | NO |
| 85 |  112 |  1 |  101603ms | YES |
| 86 |  280 |  0 |  117093ms | NO |
| 87 |  215 |  1 |  124816ms | YES |
| 88 | NONE | NONE | > 6h | NO |
| 89 |  65 |  0 |  55588ms | NO |
| 90 |  69 |  0 |  55907ms | NO |
| 91 |  61 |  0 |  53949ms | NO |
| 92 |  90 |  0 |  65943ms | NO |
| 93 |  72 |  0 |  59208ms | NO |
| 94 |  81 |  0 |  10864663ms | NO |
| 95 |  152 |  0 |  67364ms | NO |
| 96 |  62 |  0 |  54527ms | NO |
| 97 |  82 |  1 |  152190ms | YES |
| 98 |  123 |  0 |  65029ms | NO |
| 99 |  82 |  1 |  150819ms | YES |
| 100 |  325 |  0 |  84162ms | NO |
| 101 |  60 |  0 |  68635ms | NO |
| 102 |  152 |  0 |  80675ms | NO |
| 103 |  128 |  0 |  77609ms | NO |
| 104 |  121 |  0 |  75180ms | NO |
| 105 |  85 |  0 |  53452ms | NO |
| 106 | NONE | NONE | > 6h | NO |
## Patches

### Bug 33

- Ranking nopol: 25

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 25
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 43
Nb variables in SMT : 28
Nopol Execution time : 1697215ms
----PATCH FOUND----
org.apache.commons.math3.optimization.linear.SimplexTableau:338: CONDITIONAL !(((org.apache.commons.math3.optimization.linear.SimplexTableau.this.numSlackVariables)==(org.apache.commons.math3.optimization.linear.SimplexTableau.this.constraints.size()))||((entry)<=(0)))
```

- IRL patch:

```
org.apache.commons.math3.optimization.linear.SimplexTableau

338c338
<             if (Precision.compareTo(entry, 0d, maxUlps) > 0) {
---
>             if (Precision.compareTo(entry, 0d, epsilon) > 0) {


```

### Bug 40

- Ranking nopol: 46

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 46
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 697
Nb variables in SMT : 31
Nopol Execution time : 1323734ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BracketingNthOrderBrentSolver:260: CONDITIONAL ((signChangeIndex - start) >= (end - signChangeIndex))||((xA)<=(absYA))
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BracketingNthOrderBrentSolver

235c235,238
<                 targetY = -REDUCTION_FACTOR * yB;
---
>                 final int p = agingA - MAXIMAL_AGING;
>                 final double weightA = (1 << p) - 1;
>                 final double weightB = p + 1;
>                 targetY = (weightA * yA - weightB * REDUCTION_FACTOR * yB) / (weightA + weightB);
238c241,244
<                 targetY = -REDUCTION_FACTOR * yA;
---
>                 final int p = agingB - MAXIMAL_AGING;
>                 final double weightA = p + 1;
>                 final double weightB = (1 << p) - 1;
>                 targetY = (weightB * yB - weightA * REDUCTION_FACTOR * yA) / (weightA + weightB);


```

### Bug 50

- Ranking nopol: 6

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 6
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 4149
Nb variables in SMT : 18
Nopol Execution time : 2332716ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BaseSecantSolver:186: CONDITIONAL (f0)<(-1)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BaseSecantSolver

186,193c186
<                     if (x == x1) {
<                         final double delta = FastMath.max(rtol * FastMath.abs(x1),
<                                                           atol);
<                         // Update formula cannot make any progress: Update the
<                         // search interval.
<                         x0 = 0.5 * (x0 + x1 - delta);
<                         f0 = computeObjectiveValue(x0);
<                     }
---
>                     // Nothing.


```

### Bug 52

- Ranking nopol: 38

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 38
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 6
Nb variables in SMT : 38
Nopol Execution time : 588594ms
----PATCH FOUND----
org.apache.commons.math.geometry.euclidean.threed.Rotation:369: CONDITIONAL (c)<=(alpha)
```

- IRL patch:

```
org.apache.commons.math.geometry.euclidean.threed.Rotation

316,319c316,319
<   double u1u1 = Vector3D.dotProduct(u1, u1);
<   double u2u2 = Vector3D.dotProduct(u2, u2);
<   double v1v1 = Vector3D.dotProduct(v1, v1);
<   double v2v2 = Vector3D.dotProduct(v2, v2);
---
>   double u1u1 = u1.getNormSq();
>   double u2u2 = u2.getNormSq();
>   double v1v1 = v1.getNormSq();
>   double v2v2 = v2.getNormSq();
324,331d323
<   double u1x = u1.getX();
<   double u1y = u1.getY();
<   double u1z = u1.getZ();
< 
<   double u2x = u2.getX();
<   double u2y = u2.getY();
<   double u2z = u2.getZ();
< 
333,341c325,329
<   double coeff = FastMath.sqrt (u1u1 / v1v1);
<   double v1x   = coeff * v1.getX();
<   double v1y   = coeff * v1.getY();
<   double v1z   = coeff * v1.getZ();
<   v1 = new Vector3D(v1x, v1y, v1z);
< 
<   // adjust v2 in order to have (u1|u2) = (v1|v2) and (v2'|v2') = (u2|u2)
<   double u1u2   = Vector3D.dotProduct(u1, u2);
<   double v1v2   = Vector3D.dotProduct(v1, v2);
---
>   v1 = new Vector3D(FastMath.sqrt(u1u1 / v1v1), v1);
> 
>   // adjust v2 in order to have (u1|u2) = (v1'|v2') and (v2'|v2') = (u2|u2)
>   double u1u2   = u1.dotProduct(u2);
>   double v1v2   = v1.dotProduct(v2);
346,353c334,336
<   double v2x    = alpha * v1x + beta * v2.getX();
<   double v2y    = alpha * v1y + beta * v2.getY();
<   double v2z    = alpha * v1z + beta * v2.getZ();
<   v2 = new Vector3D(v2x, v2y, v2z);
< 
<   // preliminary computation (we use explicit formulation instead
<   // of relying on the Vector3D class in order to avoid building lots
<   // of temporary objects)
---
>   v2 = new Vector3D(alpha, v1, beta, v2);
> 
>   // preliminary computation
356,370c339,346
<   double dx1 = v1x - u1.getX();
<   double dy1 = v1y - u1.getY();
<   double dz1 = v1z - u1.getZ();
<   double dx2 = v2x - u2.getX();
<   double dy2 = v2y - u2.getY();
<   double dz2 = v2z - u2.getZ();
<   Vector3D k = new Vector3D(dy1 * dz2 - dz1 * dy2,
<                             dz1 * dx2 - dx1 * dz2,
<                             dx1 * dy2 - dy1 * dx2);
<   double c = k.getX() * (u1y * u2z - u1z * u2y) +
<              k.getY() * (u1z * u2x - u1x * u2z) +
<              k.getZ() * (u1x * u2y - u1y * u2x);
< 
<   if (c == 0) {
<     // the (q1, q2, q3) vector is in the (u1, u2) plane
---
>   Vector3D v1Su1 = v1.subtract(u1);
>   Vector3D v2Su2 = v2.subtract(u2);
>   Vector3D k     = v1Su1.crossProduct(v2Su2);
>   Vector3D u3    = u1.crossProduct(u2);
>   double c       = k.dotProduct(u3);
>   final double inPlaneThreshold = 0.001;
>   if (c <= inPlaneThreshold * k.getNorm() * u3.getNorm()) {
>     // the (q1, q2, q3) vector is close to the (u1, u2) plane
372d347
<     Vector3D u3 = Vector3D.crossProduct(u1, u2);
374,399c349,358
<     double u3x  = u3.getX();
<     double u3y  = u3.getY();
<     double u3z  = u3.getZ();
<     double v3x  = v3.getX();
<     double v3y  = v3.getY();
<     double v3z  = v3.getZ();
< 
<     double dx3 = v3x - u3x;
<     double dy3 = v3y - u3y;
<     double dz3 = v3z - u3z;
<     k = new Vector3D(dy1 * dz3 - dz1 * dy3,
<                      dz1 * dx3 - dx1 * dz3,
<                      dx1 * dy3 - dy1 * dx3);
<     c = k.getX() * (u1y * u3z - u1z * u3y) +
<         k.getY() * (u1z * u3x - u1x * u3z) +
<         k.getZ() * (u1x * u3y - u1y * u3x);
< 
<     if (c == 0) {
<       // the (q1, q2, q3) vector is aligned with u1:
<       // we try (u2, u3) and (v2, v3)
<       k = new Vector3D(dy2 * dz3 - dz2 * dy3,
<                        dz2 * dx3 - dx2 * dz3,
<                        dx2 * dy3 - dy2 * dx3);
<       c = k.getX() * (u2y * u3z - u2z * u3y) +
<           k.getY() * (u2z * u3x - u2x * u3z) +
<           k.getZ() * (u2x * u3y - u2y * u3x);
---
>     Vector3D v3Su3 = v3.subtract(u3);
>     k = v1Su1.crossProduct(v3Su3);
>     Vector3D u2Prime = u1.crossProduct(u3);
>     c = k.dotProduct(u2Prime);
> 
>     if (c <= inPlaneThreshold * k.getNorm() * u2Prime.getNorm()) {
>       // the (q1, q2, q3) vector is also close to the (u1, u3) plane,
>       // it is almost aligned with u1: we try (u2, u3) and (v2, v3)
>       k = v2Su2.crossProduct(v3Su3);;
>       c = k.dotProduct(u2.crossProduct(u3));;
401c360
<       if (c == 0) {
---
>       if (c <= 0) {
430,431c389
<    c = Vector3D.dotProduct(k, k);
<   q0 = Vector3D.dotProduct(vRef, k) / (c + c);
---
>   q0 = vRef.dotProduct(k) / (2 * k.getNormSq());
455c413
<     double dot = Vector3D.dotProduct(u, v);
---
>     double dot = u.dotProduct(v);
470,472c428,431
<       q1 = coeff * (v.getY() * u.getZ() - v.getZ() * u.getY());
<       q2 = coeff * (v.getZ() * u.getX() - v.getX() * u.getZ());
<       q3 = coeff * (v.getX() * u.getY() - v.getY() * u.getX());
---
>       Vector3D q = v.crossProduct(u);
>       q1 = coeff * q.getX();
>       q2 = coeff * q.getY();
>       q3 = coeff * q.getZ();


```

### Bug 57

- Ranking nopol: 61

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 61
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 6
Nb variables in SMT : 11
Nopol Execution time : 4194419ms
----PATCH FOUND----
org.apache.commons.math.stat.clustering.EuclideanIntegerPoint:85: CONDITIONAL (((point[i]) != (otherPoint[i]))&&(!((otherPoint.length)==(1))))||((org.apache.commons.math.stat.clustering.EuclideanIntegerPoint.serialVersionUID)<=(-1))
```

- IRL patch:

```
org.apache.commons.math.stat.clustering.KMeansPlusPlusClusterer

175c175
<             int sum = 0;
---
>             double sum = 0;


```

### Bug 58

- Ranking nopol: 110

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 110
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 925
Nb variables in SMT : 43
Nopol Execution time : 2287719ms
----PATCH FOUND----
org.apache.commons.math.optimization.general.LevenbergMarquardtOptimizer:613: CONDITIONAL ((gNorm)<=(org.apache.commons.math.optimization.general.LevenbergMarquardtOptimizer.this.orthoTolerance))||(fp > 0)
```

- IRL patch:

```
org.apache.commons.math.optimization.fitting.GaussianFitter

120,121c120,121
<         return fit(new Gaussian.Parametric(),
<                    (new ParameterGuesser(getObservations())).guess());
---
>         final double[] guess = (new ParameterGuesser(getObservations())).guess();
>         return fit(guess);


```

### Bug 73

- Ranking nopol: 63

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 63
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 20
Nb variables in SMT : 13
Nopol Execution time : 94188ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.UnivariateRealSolverImpl:225: CONDITIONAL ((initial)<=(lower))||((!((1)!=(lower)))&&((org.apache.commons.math.analysis.solvers.UnivariateRealSolverImpl.this.result)<(1)))
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BrentSolver

34a35,39
>     /** Error message for non-bracketing interval. */
>     private static final String NON_BRACKETING_MESSAGE =
>         "function values at endpoints do not have different signs.  " +
>         "Endpoints: [{0}, {1}], Values: [{2}, {3}]";
> 
130a136,140
>         if (yMin * yMax > 0) {
>             throw MathRuntimeException.createIllegalArgumentException(
>                   NON_BRACKETING_MESSAGE, min, max, yMin, yMax);
>         }
> 
179,181c189
<                         "function values at endpoints do not have different signs.  " +
<                         "Endpoints: [{0}, {1}], Values: [{2}, {3}]",
<                         min, max, yMin, yMax);
---
>                         NON_BRACKETING_MESSAGE, min, max, yMin, yMax);


```

### Bug 81

- Ranking nopol: 46

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 46
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 15
Nb variables in SMT : 56
Nopol Execution time : 108674ms
----PATCH FOUND----
org.apache.commons.math.linear.EigenDecompositionImpl:1534: CONDITIONAL (org.apache.commons.math.linear.EigenDecompositionImpl.TOLERANCE)<=(org.apache.commons.math.linear.EigenDecompositionImpl.this.lowerSpectra)
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

598,599c598,603
<         work[lowerStart + m - 1] = dCurrent - eCurrent;
<         work[upperStart + m - 1] = dCurrent + eCurrent;
---
>         final double lower = dCurrent - eCurrent;
>         work[lowerStart + m - 1] = lower;
>         lowerSpectra = Math.min(lowerSpectra, lower);
>         final double upper = dCurrent + eCurrent;
>         work[upperStart + m - 1] = upper;
>         upperSpectra = Math.max(upperSpectra, upper);
902,903c906,907
<                     for (int i = 4 * i0; i < 4 * n0 - 11; i += 4) {
<                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) &&
---
>                     for (int i = 4 * i0; i < 4 * n0 - 16; i += 4) {
>                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) ||
1540c1544
<                 if (end - start > 2) {
---
>                 if (end - start > 3) {


```

### Bug 85

- Ranking nopol: 112

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 112
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 303
Nb variables in SMT : 17
Nopol Execution time : 101603ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.UnivariateRealSolverUtils:198: CONDITIONAL (-1)==(maximumIterations)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.UnivariateRealSolverUtils

198c198
<         if (fa * fb >= 0.0 ) {
---
>         if (fa * fb > 0.0 ) {


```

### Bug 87

- Ranking nopol: 215

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 215
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 120
Nb variables in SMT : 30
Nopol Execution time : 124816ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexTableau:160: CONDITIONAL ((org.apache.commons.math.optimization.linear.SimplexTableau.this.numSlackVariables)!=(1))&&(!(org.apache.commons.math.optimization.linear.SimplexTableau.this.restrictToNonNegative))
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

275,276c275
<             if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
<                 if (row == null) {
---
>             if (MathUtils.equals(getEntry(i, col), 1.0, epsilon) && (row == null)) {
278c277
<                 } else {
---
>             } else if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
282d280
<         }


```

### Bug 97

- Ranking nopol: 82

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 82
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 461
Nb variables in SMT : 11
Nopol Execution time : 152190ms
----PATCH FOUND----
org.apache.commons.math.analysis.BrentSolver:135: CONDITIONAL ((yMin * yMax) >= 0)&&(!(((1)<(min))||((0)<=(org.apache.commons.math.analysis.BrentSolver.serialVersionUID))))
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 99

- Ranking nopol: 82

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 82
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 461
Nb variables in SMT : 11
Nopol Execution time : 150819ms
----PATCH FOUND----
org.apache.commons.math.analysis.BrentSolver:135: CONDITIONAL ((yMin * yMax) >= 0)&&(!(((1)<(min))||((0)<=(org.apache.commons.math.analysis.BrentSolver.serialVersionUID))))
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

