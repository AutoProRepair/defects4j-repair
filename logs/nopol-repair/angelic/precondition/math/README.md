# Math - Nopol angelic precondition repair


- Nb patch found: 22/106

| #Bug | Nb Statements Analyzed | Nb Angelic Value Found | Exec. time | Patch Found |
|------|---------------|--------------|------------|------------|
| 1 | NONE | NONE | > 6h | NO |
| 2 | NONE | NONE | > 6h | NO |
| 3 |  21 |  0 |  821172ms | NO |
| 4 |  281 |  0 |  847086ms | NO |
| 5 |  17 |  0 |  1599760ms | NO |
| 6 | NONE | NONE | > 6h | NO |
| 7 |  1 |  1 |  2522787ms | YES |
| 8 |  134 |  0 |  2833255ms | NO |
| 9 |  91 |  0 |  1822612ms | NO |
| 10 |  209 |  0 |  16220115ms | NO |
| 11 |  433 |  0 |  1934578ms | NO |
| 12 | NONE | NONE | > 6h | NO |
| 13 |  87 |  0 |  1959964ms | NO |
| 14 |  102 |  0 |  1953819ms | NO |
| 15 |  1 |  1 |  1905713ms | YES |
| 16 | NONE | NONE | > 6h | NO |
| 17 | NONE | NONE | > 6h | NO |
| 18 |  46 |  1 |  1821706ms | YES |
| 19 |  346 |  0 |  1216924ms | NO |
| 20 |  9 |  1 |  1765032ms | YES |
| 21 |  188 |  0 |  8397497ms | NO |
| 22 |  263 |  0 |  1227296ms | NO |
| 23 | NONE | NONE | > 6h | NO |
| 24 |  4 |  1 |  1784928ms | YES |
| 25 |  159 |  0 |  1172685ms | NO |
| 26 | NONE | NONE | > 6h | NO |
| 27 | NONE | NONE | > 6h | NO |
| 28 | NONE | NONE | > 6h | NO |
| 29 | NONE | NONE | > 6h | NO |
| 30 |  77 |  0 |  1073685ms | NO |
| 31 | NONE | NONE | > 6h | NO |
| 32 |  260 |  1 |  1808238ms | YES |
| 33 |  6 |  1 |  1988254ms | YES |
| 34 |  36 |  0 |  987040ms | NO |
| 35 |  21 |  0 |  1018924ms | NO |
| 36 |  17 |  0 |  981238ms | NO |
| 37 | NONE | NONE | > 6h | NO |
| 38 |  262 |  0 |  4361540ms | NO |
| 39 | NONE | NONE | > 6h | NO |
| 40 |  5 |  1 |  1492192ms | YES |
| 41 | NONE | NONE | > 6h | NO |
| 42 | NONE | NONE | > 6h | NO |
| 43 |  308 |  0 |  690167ms | NO |
| 44 | NONE | NONE | > 6h | NO |
| 45 |  27 |  0 |  392100ms | NO |
| 46 |  63 |  2 |  752862ms | NO |
| 47 |  113 |  0 |  466362ms | NO |
| 48 | NONE | NONE | > 6h | NO |
| 49 |  12 |  1 |  707327ms | YES |
| 50 |  6 |  1 |  3249194ms | YES |
| 51 | NONE | NONE | > 6h | NO |
| 52 |  93 |  0 |  281120ms | NO |
| 53 |  14 |  0 |  370742ms | NO |
| 54 | NONE | NONE | > 6h | NO |
| 55 |  104 |  0 |  388355ms | NO |
| 56 | NONE | NONE | > 6h | NO |
| 57 |  55 |  1 |  7928003ms | YES |
| 58 | NONE | NONE | > 6h | NO |
| 59 | NONE | NONE | > 6h | NO |
| 60 | NONE | NONE | > 6h | NO |
| 61 |  56 |  0 |  144619ms | NO |
| 62 | NONE | NONE | > 6h | NO |
| 63 |  9 |  0 |  115353ms | NO |
| 64 | NONE | NONE | > 6h | NO |
| 65 |  420 |  0 |  270424ms | NO |
| 66 | NONE | NONE | > 6h | NO |
| 67 | NONE | NONE | > 6h | NO |
| 68 |  428 |  0 |  7446382ms | NO |
| 69 |  21 |  1 |  154723ms | YES |
| 70 |  31 |  0 |  100507ms | NO |
| 71 | NONE | NONE | > 6h | NO |
| 72 |  111 |  0 |  103639ms | NO |
| 73 |  140 |  0 |  114447ms | NO |
| 74 | NONE | NONE | > 6h | NO |
| 75 |  112 |  0 |  3718154ms | NO |
| 76 |  517 |  0 |  3891965ms | NO |
| 77 |  166 |  0 |  141457ms | NO |
| 78 |  70 |  1 |  183182ms | YES |
| 79 |  70 |  1 |  4584380ms | YES |
| 80 |  31 |  1 |  177967ms | YES |
| 81 |  48 |  1 |  157137ms | YES |
| 82 |  119 |  1 |  3748800ms | YES |
| 83 |  291 |  0 |  7358106ms | NO |
| 84 |  212 |  0 |  7329271ms | NO |
| 85 | NONE | NONE | > 6h | NO |
| 86 | NONE | NONE | > 6h | NO |
| 87 |  88 |  1 |  3729007ms | YES |
| 88 |  39 |  1 |  119820ms | YES |
| 89 |  65 |  0 |  84430ms | NO |
| 90 |  69 |  0 |  84080ms | NO |
| 91 |  61 |  0 |  81366ms | NO |
| 92 |  90 |  0 |  96057ms | NO |
| 93 |  72 |  0 |  90535ms | NO |
| 94 | NONE | NONE | > 6h | NO |
| 95 | NONE | NONE | > 6h | NO |
| 96 |  62 |  0 |  80561ms | NO |
| 97 |  61 |  1 |  102012ms | YES |
| 98 |  123 |  0 |  95215ms | NO |
| 99 |  61 |  1 |  103015ms | YES |
| 100 |  325 |  0 |  3664827ms | NO |
| 101 |  60 |  0 |  65264ms | NO |
| 102 | NONE | NONE | > 6h | NO |
| 103 |  128 |  0 |  3671485ms | NO |
| 104 | NONE | NONE | > 6h | NO |
| 105 |  72 |  1 |  61547ms | YES |
| 106 | NONE | NONE | > 6h | NO |
## Patches

### Bug 7

- Ranking nopol: 1

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 1
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 159
Nb variables in SMT : 38
Nopol Execution time : 2522787ms
----PATCH FOUND----
org.apache.commons.math3.ode.AbstractIntegrator:349: PRECONDITION (org.apache.commons.math3.ode.AbstractIntegrator.this.stepHandlers.size())==(1)
```

- IRL patch:

```
org.apache.commons.math3.ode.AbstractIntegrator

341c341
<                 // trigger the event
---
>                 // get state at event time
344,345c344,349
<                 currentEvent.stepAccepted(eventT, eventY);
<                 isLastStep = currentEvent.stop();
---
> 
>                 // advance all event states to current time
>                 for (final EventState state : eventsStates) {
>                     state.stepAccepted(eventT, eventY);
>                     isLastStep = isLastStep || state.stop();
>                 }
355,357d358
<                     for (final EventState remaining : occuringEvents) {
<                         remaining.stepAccepted(eventT, eventY);
<                     }
361c362,366
<                 if (currentEvent.reset(eventT, eventY)) {
---
>                 boolean needReset = false;
>                 for (final EventState state : eventsStates) {
>                     needReset =  needReset || state.reset(eventT, eventY);
>                 }
>                 if (needReset) {
367,369d371
<                     for (final EventState remaining : occuringEvents) {
<                         remaining.stepAccepted(eventT, eventY);
<                     }


```

### Bug 15

- Ranking nopol: 1

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 1
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 10
Nb variables in SMT : 63
Nopol Execution time : 1905713ms
----PATCH FOUND----
org.apache.commons.math3.util.FastMath:1541: PRECONDITION (x)!=(-1)
```

- IRL patch:

```
org.apache.commons.math3.util.FastMath

311a312,313
>     /** 2^53 - double numbers this large must be even. */
>     private static final double TWO_POWER_53 = 2 * TWO_POWER_52;
1540c1542
<             if (y >= TWO_POWER_52 || y <= -TWO_POWER_52) {
---
>             if (y >= TWO_POWER_53 || y <= -TWO_POWER_53) {


```

### Bug 18

- Ranking nopol: 47

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 46
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 8
Nb variables in SMT : 72
Nopol Execution time : 1821706ms
----PATCH FOUND----
org.apache.commons.math3.optimization.direct.CMAESOptimizer:514: PRECONDITION (org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.stopTolFun)==(org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.mu)
```

- IRL patch:

```
org.apache.commons.math3.optimization.direct.CMAESOptimizer

932c932
<                 res[i] = (x[i] - boundaries[0][i]) / diff;
---
>                 res[i] = x[i] / diff;
958c958
<                 res[i] = diff * x[i] + boundaries[0][i];
---
>                 res[i] = diff * x[i];
988a989,992
> 
>             final double[] bLoEnc = encode(boundaries[0]);
>             final double[] bHiEnc = encode(boundaries[1]);
> 
990c994
<                 if (x[i] < 0) {
---
>                 if (x[i] < bLoEnc[i]) {
993c997
<                 if (x[i] > 1.0) {
---
>                 if (x[i] > bHiEnc[i]) {


```

### Bug 20

- Ranking nopol: 8

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 9
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 92
Nb variables in SMT : 73
Nopol Execution time : 1765032ms
----PATCH FOUND----
org.apache.commons.math3.optimization.direct.CMAESOptimizer$FitnessFunction:986: PRECONDITION org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.inputSigma!=null
```

- IRL patch:

```
org.apache.commons.math3.optimization.direct.CMAESOptimizer

419c419
<                             fitfun.decode(bestArx.getColumn(0)),
---
>                             fitfun.repairAndDecode(bestArx.getColumn(0)),
917a918,927
>          * @return the original objective variables, possibly repaired.
>          */
>         public double[] repairAndDecode(final double[] x) {
>             return boundaries != null && isRepairMode ?
>                 decode(repair(x)) :
>                 decode(x);
>         }
> 
>         /**
>          * @param x Normalized objective variables.


```

### Bug 24

- Ranking nopol: 4

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 8
Nb variables in SMT : 6
Nopol Execution time : 1784928ms
----PATCH FOUND----
org.apache.commons.math3.analysis.FunctionUtils$4:145: PRECONDITION (0)<=(r)
```

- IRL patch:

```
org.apache.commons.math3.optimization.univariate.BrentOptimizer

230c230
<                         return current;
---
>                         return best(current, previous, isMinim);
267c267
<                 return current;
---
>                 return best(current, previous, isMinim);
271a272,298
> 
>     /**
>      * Selects the best of two points.
>      *
>      * @param a Point and value.
>      * @param b Point and value.
>      * @param isMinim {@code true} if the selected point must be the one with
>      * the lowest value.
>      * @return the best point, or {@code null} if {@code a} and {@code b} are
>      * both {@code null}.
>      */
>     private UnivariatePointValuePair best(UnivariatePointValuePair a,
>                                           UnivariatePointValuePair b,
>                                           boolean isMinim) {
>         if (a == null) {
>             return b;
>         }
>         if (b == null) {
>             return a;
>         }
> 
>         if (isMinim) {
>             return a.getValue() < b.getValue() ? a : b;
>         } else {
>             return a.getValue() > b.getValue() ? a : b;
>         }
>     }


```

### Bug 32

- Ranking nopol: 260

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 260
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 24
Nb variables in SMT : 20
Nopol Execution time : 1808238ms
----PATCH FOUND----
org.apache.commons.math3.geometry.partitioning.AbstractRegion:214: PRECONDITION ((!(((boundary.size())-(plusList.size()))<(minusList.size())))&&((1)<=(plusList.size())))||((minusList.size())==((boundary.size())+(-1)))
```

- IRL patch:

```
org.apache.commons.math3.geometry.euclidean.twod.PolygonsSet

135c135,137
<             if ((Boolean) getTree(false).getAttribute()) {
---
>             final BSPTree<Euclidean2D> tree = getTree(false);
>             if (tree.getCut() == null && (Boolean) tree.getAttribute()) {
>                 // the instance covers the whole space


```

### Bug 33

- Ranking nopol: 6

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 6
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 17
Nb variables in SMT : 27
Nopol Execution time : 1988254ms
----PATCH FOUND----
org.apache.commons.math3.optimization.linear.SimplexTableau:339: PRECONDITION (org.apache.commons.math3.optimization.linear.SimplexTableau.this.constraints.size())!=(org.apache.commons.math3.optimization.linear.SimplexTableau.this.numSlackVariables)
```

- IRL patch:

```
org.apache.commons.math3.optimization.linear.SimplexTableau

338c338
<             if (Precision.compareTo(entry, 0d, maxUlps) > 0) {
---
>             if (Precision.compareTo(entry, 0d, epsilon) > 0) {


```

### Bug 40

- Ranking nopol: 5

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 3
Nb variables in SMT : 14
Nopol Execution time : 1492192ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BaseAbstractUnivariateRealSolver:296: PRECONDITION (org.apache.commons.math.analysis.solvers.BaseAbstractUnivariateRealSolver.DEFAULT_FUNCTION_VALUE_ACCURACY)==(org.apache.commons.math.analysis.solvers.BaseAbstractUnivariateRealSolver.this.functionValueAccuracy)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BracketingNthOrderBrentSolver

235c235,238
<                 targetY = -REDUCTION_FACTOR * yB;
---
>                 final int p = agingA - MAXIMAL_AGING;
>                 final double weightA = (1 << p) - 1;
>                 final double weightB = p + 1;
>                 targetY = (weightA * yA - weightB * REDUCTION_FACTOR * yB) / (weightA + weightB);
238c241,244
<                 targetY = -REDUCTION_FACTOR * yA;
---
>                 final int p = agingB - MAXIMAL_AGING;
>                 final double weightA = p + 1;
>                 final double weightB = (1 << p) - 1;
>                 targetY = (weightB * yB - weightA * REDUCTION_FACTOR * yA) / (weightA + weightB);


```

### Bug 49

- Ranking nopol: 12

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 12
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 8
Nb variables in SMT : 11
Nopol Execution time : 707327ms
----PATCH FOUND----
org.apache.commons.math.linear.OpenMapRealVector:667: PRECONDITION (org.apache.commons.math.linear.OpenMapRealVector.this.epsilon)==(org.apache.commons.math.linear.OpenMapRealVector.DEFAULT_ZERO_TOLERANCE)
```

- IRL patch:

```
org.apache.commons.math.linear.OpenMapRealVector

345c345
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();
358c358
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();
370c370
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();
383c383
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();


```

### Bug 50

- Ranking nopol: 6

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 6
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 4149
Nb variables in SMT : 18
Nopol Execution time : 3249194ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BaseSecantSolver:186: PRECONDITION !(((x)==(1))||(((1)<(x))&&(inverted)))
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BaseSecantSolver

186,193c186
<                     if (x == x1) {
<                         final double delta = FastMath.max(rtol * FastMath.abs(x1),
<                                                           atol);
<                         // Update formula cannot make any progress: Update the
<                         // search interval.
<                         x0 = 0.5 * (x0 + x1 - delta);
<                         f0 = computeObjectiveValue(x0);
<                     }
---
>                     // Nothing.


```

### Bug 57

- Ranking nopol: 55

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 55
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 3
Nb variables in SMT : 10
Nopol Execution time : 7928003ms
----PATCH FOUND----
org.apache.commons.math.stat.clustering.EuclideanIntegerPoint:86: PRECONDITION (1)<(otherPoint.length)
```

- IRL patch:

```
org.apache.commons.math.stat.clustering.KMeansPlusPlusClusterer

175c175
<             int sum = 0;
---
>             double sum = 0;


```

### Bug 69

- Ranking nopol: 21

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 21
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 4
Nb variables in SMT : 9
Nopol Execution time : 154723ms
----PATCH FOUND----
org.apache.commons.math.stat.correlation.PearsonsCorrelation:189: PRECONDITION ((1)-((-1)+(-1)))<=(nVars)
```

- IRL patch:

```
org.apache.commons.math.stat.correlation.PearsonsCorrelation

171c171
<                     out[i][j] = 2 * (1 - tDistribution.cumulativeProbability(t));
---
>                     out[i][j] = 2 * tDistribution.cumulativeProbability(-t);


```

### Bug 78

- Ranking nopol: 70

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 70
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 293
Nb variables in SMT : 18
Nopol Execution time : 183182ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BrentSolver:282: PRECONDITION (-1)<=(delta)
```

- IRL patch:

```
org.apache.commons.math.ode.events.EventState

190a191,210
>                     if (ga * gb > 0) {
>                         // this is a corner case:
>                         // - there was an event near ta,
>                         // - there is another event between ta and tb
>                         // - when ta was computed, convergence was reached on the "wrong side" of the interval
>                         // this implies that the real sign of ga is the same as gb, so we need to slightly
>                         // shift ta to make sure ga and gb get opposite signs and the solver won't complain
>                         // about bracketing
>                         final double epsilon = (forward ? 0.25 : -0.25) * convergence;
>                         for (int k = 0; (k < 4) && (ga * gb > 0); ++k) {
>                             ta += epsilon;
>                             interpolator.setInterpolatedTime(ta);
>                             ga = handler.g(ta, interpolator.getInterpolatedState());
>                         }
>                         if (ga * gb > 0) {
>                             // this should never happen
>                             throw MathRuntimeException.createInternalError(null);
>                         }
>                     }
>                          
209,218c229,231
<                     double root;
<                     try {
<                         root = (ta <= tb) ? solver.solve(f, ta, tb) : solver.solve(f, tb, ta);
<                     } catch (IllegalArgumentException iae) {
<                         // the interval did not really bracket a root
<                         root = Double.NaN;
<                     }
<                     if (Double.isNaN(root) ||
<                         ((Math.abs(root - ta) <= convergence) &&
<                          (Math.abs(root - previousEventTime) <= convergence))) {
---
>                     final double root = (ta <= tb) ? solver.solve(f, ta, tb) : solver.solve(f, tb, ta);
>                     if ((Math.abs(root - ta) <= convergence) &&
>                          (Math.abs(root - previousEventTime) <= convergence)) {


```

### Bug 79

- Ranking nopol: 70

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 70
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 118
Nb variables in SMT : 23
Nopol Execution time : 4584380ms
----PATCH FOUND----
org.apache.commons.math.util.MathUtils:1627: PRECONDITION (!((((org.apache.commons.math.util.MathUtils.FACTORIALS.length)+(org.apache.commons.math.util.MathUtils.FACTORIALS.length))<(dp))||((dp)<=((org.apache.commons.math.util.MathUtils.TWO_PI)-((org.apache.commons.math.util.MathUtils.FACTORIALS.length)+(org.apache.commons.math.util.MathUtils.FACTORIALS.length))))))&&(p2!=null)
```

- IRL patch:

```
org.apache.commons.math.util.MathUtils

1624c1624
<       int sum = 0;
---
>       double sum = 0;
1626c1626
<           final int dp = p1[i] - p2[i];
---
>           final double dp = p1[i] - p2[i];


```

### Bug 80

- Ranking nopol: 31

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 31
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 4
Nb variables in SMT : 44
Nopol Execution time : 177967ms
----PATCH FOUND----
org.apache.commons.math.linear.EigenDecompositionImpl:1137: PRECONDITION org.apache.commons.math.linear.EigenDecompositionImpl.this.cachedD!=null
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

1135c1135
<             int j = 4 * n - 1;
---
>             int j = 4 * (n - 1);


```

### Bug 81

- Ranking nopol: 48

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 48
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 15
Nb variables in SMT : 57
Nopol Execution time : 157137ms
----PATCH FOUND----
org.apache.commons.math.linear.EigenDecompositionImpl:1540: PRECONDITION (org.apache.commons.math.linear.EigenDecompositionImpl.this.lowerSpectra)<(org.apache.commons.math.linear.EigenDecompositionImpl.this.splitTolerance)
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

598,599c598,603
<         work[lowerStart + m - 1] = dCurrent - eCurrent;
<         work[upperStart + m - 1] = dCurrent + eCurrent;
---
>         final double lower = dCurrent - eCurrent;
>         work[lowerStart + m - 1] = lower;
>         lowerSpectra = Math.min(lowerSpectra, lower);
>         final double upper = dCurrent + eCurrent;
>         work[upperStart + m - 1] = upper;
>         upperSpectra = Math.max(upperSpectra, upper);
902,903c906,907
<                     for (int i = 4 * i0; i < 4 * n0 - 11; i += 4) {
<                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) &&
---
>                     for (int i = 4 * i0; i < 4 * n0 - 16; i += 4) {
>                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) ||
1540c1544
<                 if (end - start > 2) {
---
>                 if (end - start > 3) {


```

### Bug 82

- Ranking nopol: 119

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 119
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 2
Nb variables in SMT : 9
Nopol Execution time : 3748800ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexSolver:63: PRECONDITION (0)!=(minValue)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexSolver

80,82c80,83
<             double rhs = tableau.getEntry(i, tableau.getWidth() - 1);
<             if (MathUtils.compareTo(tableau.getEntry(i, col), 0, epsilon) >= 0) {
<                 double ratio = rhs / tableau.getEntry(i, col);
---
>             final double rhs = tableau.getEntry(i, tableau.getWidth() - 1);
>             final double entry = tableau.getEntry(i, col);
>             if (MathUtils.compareTo(entry, 0, epsilon) > 0) {
>                 final double ratio = rhs / entry;


```

### Bug 87

- Ranking nopol: 88

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 88
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 18
Nb variables in SMT : 29
Nopol Execution time : 3729007ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexTableau:161: PRECONDITION (1)!=(org.apache.commons.math.optimization.linear.SimplexTableau.this.numSlackVariables)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

275,276c275
<             if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
<                 if (row == null) {
---
>             if (MathUtils.equals(getEntry(i, col), 1.0, epsilon) && (row == null)) {
278c277
<                 } else {
---
>             } else if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
282d280
<         }


```

### Bug 88

- Ranking nopol: 39

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 39
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 124
Nb variables in SMT : 18
Nopol Execution time : 119820ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexTableau:352: PRECONDITION (org.apache.commons.math.optimization.linear.SimplexTableau.this.numSlackVariables)<(org.apache.commons.math.optimization.linear.SimplexTableau.this.constraints.size())
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

326c326,329
<         double mostNegative = getDecisionVariableValue(getOriginalNumDecisionVariables());
---
>         Integer basicRow =
>             getBasicRow(getNumObjectiveFunctions() + getOriginalNumDecisionVariables());
>         double mostNegative = basicRow == null ? 0 : getEntry(basicRow, getRhsOffset());
>         Set<Integer> basicRows = new HashSet<Integer>();
327a331,337
>             basicRow = getBasicRow(getNumObjectiveFunctions() + i);
>             if (basicRows.contains(basicRow)) {
>                 // if multiple variables can take a given value 
>                 // then we choose the first and set the rest equal to 0
>                 coefficients[i] = 0;
>             } else {
>                 basicRows.add(basicRow);
329,352c339,340
<                 getDecisionVariableValue(i) - (restrictToNonNegative ? 0 : mostNegative); 
<         }
<         return new RealPointValuePair(coefficients, f.getValue(coefficients));
<     }
< 
<     /**
<      * Get the value of the given decision variable.  This is not the actual
<      * value as it is guaranteed to be >= 0 and thus must be corrected before
<      * being returned to the user.
<      * 
<      * @param decisionVariable The index of the decision variable
<      * @return The value of the given decision variable.
<      */
<     protected double getDecisionVariableValue(final int decisionVariable) {
<       int col = getNumObjectiveFunctions() + decisionVariable;  
<       Integer basicRow = getBasicRow(col);
<       if (basicRow == null) {
<           return 0;
<       }
<       // if there are multiple variables that can take the value on the RHS
<       // then we'll give the first variable that value
<       for (int i = getNumObjectiveFunctions(); i < col; i++) {
<           if (tableau.getEntry(basicRow, i) == 1) {
<               return 0;
---
>                     (basicRow == null ? 0 : getEntry(basicRow, getRhsOffset())) -
>                     (restrictToNonNegative ? 0 : mostNegative);
355c343
<       return getEntry(basicRow, getRhsOffset()); 
---
>         return new RealPointValuePair(coefficients, f.getValue(coefficients));


```

### Bug 97

- Ranking nopol: 61

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 61
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 3
Nb variables in SMT : 9
Nopol Execution time : 102012ms
----PATCH FOUND----
org.apache.commons.math.analysis.BrentSolver:136: PRECONDITION (min)<=(1)
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 99

- Ranking nopol: 61

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 61
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 3
Nb variables in SMT : 9
Nopol Execution time : 103015ms
----PATCH FOUND----
org.apache.commons.math.analysis.BrentSolver:136: PRECONDITION (min)<=(1)
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 105

- Ranking nopol: 72

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 72
Nb Statements with Angelic Value Found : 1
Nb inputs in SMT : 10
Nb variables in SMT : 15
Nopol Execution time : 61547ms
----PATCH FOUND----
org.apache.commons.math.stat.regression.SimpleRegression:107: PRECONDITION (((y)<=(x))&&((y)<=(x)))||(!((1)<(x)))
```

- IRL patch:

```
org.apache.commons.math.stat.regression.SimpleRegression

264c264
<         return sumYY - sumXY * sumXY / sumXX;
---
>         return Math.max(0d, sumYY - sumXY * sumXY / sumXX);


```

