# Math - Nopol angelic precondition repair


- Nb patch found: 24/106

| #Bug | Nb Statements Analyzed | Nb Angelic Value Found | Exec. time | Patch Found |
|------|---------------|--------------|------------|------------|
| 1 | NONE | NONE | > 6h | NO |
| 2 | NONE | NONE | > 6h | NO |
| 3 |  21 |  0 |  643418ms | NO |
| 4 |  281 |  0 |  614891ms | NO |
| 5 |  17 |  2 |  1813781ms | NO |
| 6 | NONE | NONE | > 6h | NO |
| 7 |  1 |  1 |  1834125ms | YES |
| 8 | NONE | NONE | > 6h | NO |
| 9 |  91 |  0 |  1240338ms | NO |
| 10 |  209 |  0 |  15698499ms | NO |
| 11 | NONE | NONE | > 6h | NO |
| 12 | NONE | NONE | > 6h | NO |
| 13 |  87 |  0 |  1252481ms | NO |
| 14 |  102 |  0 |  1194554ms | NO |
| 15 |  1 |  1 |  1244620ms | YES |
| 16 | NONE | NONE | > 6h | NO |
| 17 | NONE | NONE | > 6h | NO |
| 18 |  47 |  1 |  1246253ms | YES |
| 19 |  346 |  1 |  1010913ms | NO |
| 20 |  8 |  1 |  1212050ms | YES |
| 21 |  188 |  0 |  4405051ms | NO |
| 22 | NONE | NONE | > 6h | NO |
| 23 | NONE | NONE | > 6h | NO |
| 24 |  4 |  1 |  1222274ms | YES |
| 25 |  159 |  0 |  738071ms | NO |
| 26 | NONE | NONE | > 6h | NO |
| 27 | NONE | NONE | > 6h | NO |
| 28 | NONE | NONE | > 6h | NO |
| 29 | NONE | NONE | > 6h | NO |
| 30 |  77 |  1 |  959743ms | NO |
| 31 | NONE | NONE | > 6h | NO |
| 32 |  260 |  1 |  1184359ms | YES |
| 33 |  6 |  1 |  1444838ms | YES |
| 34 |  36 |  0 |  676301ms | NO |
| 35 |  21 |  0 |  672776ms | NO |
| 36 |  17 |  0 |  642031ms | NO |
| 37 | NONE | NONE | > 6h | NO |
| 38 |  262 |  0 |  4139719ms | NO |
| 39 | NONE | NONE | > 6h | NO |
| 40 |  5 |  1 |  1138828ms | YES |
| 41 |  110 |  22 |  10055510ms | NO |
| 42 | NONE | NONE | > 6h | NO |
| 43 |  308 |  1 |  4499262ms | NO |
| 44 | NONE | NONE | > 6h | NO |
| 45 |  27 |  0 |  331429ms | NO |
| 46 |  63 |  2 |  631225ms | NO |
| 47 |  113 |  0 |  3973561ms | NO |
| 48 | NONE | NONE | > 6h | NO |
| 49 |  12 |  1 |  539501ms | YES |
| 50 |  6 |  1 |  930372ms | YES |
| 51 | NONE | NONE | > 6h | NO |
| 52 |  38 |  1 |  639778ms | YES |
| 53 |  14 |  0 |  315245ms | NO |
| 54 | NONE | NONE | > 6h | NO |
| 55 |  9 |  0 |  315296ms | NO |
| 56 | NONE | NONE | > 6h | NO |
| 57 |  55 |  1 |  7824543ms | YES |
| 58 | NONE | NONE | > 6h | NO |
| 59 | NONE | NONE | > 6h | NO |
| 60 | NONE | NONE | > 6h | NO |
| 61 |  56 |  0 |  100523ms | NO |
| 62 | NONE | NONE | > 6h | NO |
| 63 |  9 |  0 |  76936ms | NO |
| 64 | NONE | NONE | > 6h | NO |
| 65 |  420 |  0 |  156047ms | NO |
| 66 | NONE | NONE | > 6h | NO |
| 67 | NONE | NONE | > 6h | NO |
| 68 |  428 |  0 |  7346947ms | NO |
| 69 |  22 |  2 |  149763ms | YES |
| 70 |  31 |  0 |  68174ms | NO |
| 71 | NONE | NONE | > 6h | NO |
| 72 |  111 |  0 |  64685ms | NO |
| 73 |  63 |  1 |  93268ms | YES |
| 74 | NONE | NONE | > 6h | NO |
| 75 |  112 |  0 |  3675540ms | NO |
| 76 |  517 |  0 |  3767704ms | NO |
| 77 |  166 |  0 |  86770ms | NO |
| 78 |  70 |  1 |  130092ms | YES |
| 79 |  70 |  2 |  1432218ms | YES |
| 80 |  31 |  1 |  125753ms | YES |
| 81 |  46 |  1 |  104191ms | YES |
| 82 |  119 |  1 |  3694476ms | YES |
| 83 |  291 |  0 |  7293148ms | NO |
| 84 |  212 |  0 |  7287262ms | NO |
| 85 | NONE | NONE | > 6h | NO |
| 86 | NONE | NONE | > 6h | NO |
| 87 |  88 |  1 |  3685387ms | YES |
| 88 |  39 |  1 |  80261ms | YES |
| 89 |  65 |  0 |  52711ms | NO |
| 90 |  69 |  0 |  52986ms | NO |
| 91 |  61 |  0 |  53280ms | NO |
| 92 | NONE | NONE | > 6h | NO |
| 93 |  72 |  0 |  58815ms | NO |
| 94 | NONE | NONE | > 6h | NO |
| 95 | NONE | NONE | > 6h | NO |
| 96 |  62 |  0 |  53796ms | NO |
| 97 |  61 |  1 |  73351ms | YES |
| 98 |  123 |  0 |  61982ms | NO |
| 99 |  61 |  1 |  72932ms | YES |
| 100 |  325 |  0 |  3684269ms | NO |
| 101 |  60 |  0 |  49959ms | NO |
| 102 | NONE | NONE | > 6h | NO |
| 103 |  128 |  0 |  3666887ms | NO |
| 104 | NONE | NONE | > 6h | NO |
| 105 |  72 |  1 |  68625ms | YES |
| 106 | NONE | NONE | > 6h | NO |
## Patches

### Bug 7

- Ranking nopol: 1

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 1
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1834125ms
----PATCH FOUND----
org.apache.commons.math3.ode.AbstractIntegrator:349: PRECONDITION (org.apache.commons.math3.ode.AbstractIntegrator.this.stepHandlers.size())==(1)
```

- IRL patch:

```
org.apache.commons.math3.ode.AbstractIntegrator

341c341
<                 // trigger the event
---
>                 // get state at event time
344,345c344,349
<                 currentEvent.stepAccepted(eventT, eventY);
<                 isLastStep = currentEvent.stop();
---
> 
>                 // advance all event states to current time
>                 for (final EventState state : eventsStates) {
>                     state.stepAccepted(eventT, eventY);
>                     isLastStep = isLastStep || state.stop();
>                 }
355,357d358
<                     for (final EventState remaining : occuringEvents) {
<                         remaining.stepAccepted(eventT, eventY);
<                     }
361c362,366
<                 if (currentEvent.reset(eventT, eventY)) {
---
>                 boolean needReset = false;
>                 for (final EventState state : eventsStates) {
>                     needReset =  needReset || state.reset(eventT, eventY);
>                 }
>                 if (needReset) {
367,369d371
<                     for (final EventState remaining : occuringEvents) {
<                         remaining.stepAccepted(eventT, eventY);
<                     }


```

### Bug 15

- Ranking nopol: 1

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 1
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1244620ms
----PATCH FOUND----
org.apache.commons.math3.util.FastMath:1541: PRECONDITION (x)!=(-1)
```

- IRL patch:

```
org.apache.commons.math3.util.FastMath

311a312,313
>     /** 2^53 - double numbers this large must be even. */
>     private static final double TWO_POWER_53 = 2 * TWO_POWER_52;
1540c1542
<             if (y >= TWO_POWER_52 || y <= -TWO_POWER_52) {
---
>             if (y >= TWO_POWER_53 || y <= -TWO_POWER_53) {


```

### Bug 18

- Ranking nopol: 47

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 47
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1246253ms
----PATCH FOUND----
org.apache.commons.math3.optimization.direct.CMAESOptimizer:514: PRECONDITION (org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.chiN)==(org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.cs)
```

- IRL patch:

```
org.apache.commons.math3.optimization.direct.CMAESOptimizer

932c932
<                 res[i] = (x[i] - boundaries[0][i]) / diff;
---
>                 res[i] = x[i] / diff;
958c958
<                 res[i] = diff * x[i] + boundaries[0][i];
---
>                 res[i] = diff * x[i];
988a989,992
> 
>             final double[] bLoEnc = encode(boundaries[0]);
>             final double[] bHiEnc = encode(boundaries[1]);
> 
990c994
<                 if (x[i] < 0) {
---
>                 if (x[i] < bLoEnc[i]) {
993c997
<                 if (x[i] > 1.0) {
---
>                 if (x[i] > bHiEnc[i]) {


```

### Bug 20

- Ranking nopol: 8

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 8
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1212050ms
----PATCH FOUND----
org.apache.commons.math3.optimization.direct.CMAESOptimizer$FitnessFunction:986: PRECONDITION org.apache.commons.math3.optimization.direct.CMAESOptimizer.this.inputSigma!=null
```

- IRL patch:

```
org.apache.commons.math3.optimization.direct.CMAESOptimizer

419c419
<                             fitfun.decode(bestArx.getColumn(0)),
---
>                             fitfun.repairAndDecode(bestArx.getColumn(0)),
917a918,927
>          * @return the original objective variables, possibly repaired.
>          */
>         public double[] repairAndDecode(final double[] x) {
>             return boundaries != null && isRepairMode ?
>                 decode(repair(x)) :
>                 decode(x);
>         }
> 
>         /**
>          * @param x Normalized objective variables.


```

### Bug 24

- Ranking nopol: 4

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 4
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1222274ms
----PATCH FOUND----
org.apache.commons.math3.analysis.FunctionUtils$4:145: PRECONDITION (0)<=(r)
```

- IRL patch:

```
org.apache.commons.math3.optimization.univariate.BrentOptimizer

230c230
<                         return current;
---
>                         return best(current, previous, isMinim);
267c267
<                 return current;
---
>                 return best(current, previous, isMinim);
271a272,298
> 
>     /**
>      * Selects the best of two points.
>      *
>      * @param a Point and value.
>      * @param b Point and value.
>      * @param isMinim {@code true} if the selected point must be the one with
>      * the lowest value.
>      * @return the best point, or {@code null} if {@code a} and {@code b} are
>      * both {@code null}.
>      */
>     private UnivariatePointValuePair best(UnivariatePointValuePair a,
>                                           UnivariatePointValuePair b,
>                                           boolean isMinim) {
>         if (a == null) {
>             return b;
>         }
>         if (b == null) {
>             return a;
>         }
> 
>         if (isMinim) {
>             return a.getValue() < b.getValue() ? a : b;
>         } else {
>             return a.getValue() > b.getValue() ? a : b;
>         }
>     }


```

### Bug 32

- Ranking nopol: 260

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 260
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1184359ms
----PATCH FOUND----
org.apache.commons.math3.geometry.partitioning.AbstractRegion:214: PRECONDITION ((!(((boundary.size())-(plusList.size()))<(minusList.size())))&&((1)<=(plusList.size())))||((minusList.size())==((boundary.size())+(-1)))
```

- IRL patch:

```
org.apache.commons.math3.geometry.euclidean.twod.PolygonsSet

135c135,137
<             if ((Boolean) getTree(false).getAttribute()) {
---
>             final BSPTree<Euclidean2D> tree = getTree(false);
>             if (tree.getCut() == null && (Boolean) tree.getAttribute()) {
>                 // the instance covers the whole space


```

### Bug 33

- Ranking nopol: 6

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 6
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1444838ms
----PATCH FOUND----
org.apache.commons.math3.optimization.linear.SimplexTableau:339: PRECONDITION (org.apache.commons.math3.optimization.linear.SimplexTableau.this.constraints.size())!=(org.apache.commons.math3.optimization.linear.SimplexTableau.this.numSlackVariables)
```

- IRL patch:

```
org.apache.commons.math3.optimization.linear.SimplexTableau

338c338
<             if (Precision.compareTo(entry, 0d, maxUlps) > 0) {
---
>             if (Precision.compareTo(entry, 0d, epsilon) > 0) {


```

### Bug 40

- Ranking nopol: 5

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 5
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 1138828ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BaseAbstractUnivariateRealSolver:296: PRECONDITION (org.apache.commons.math.analysis.solvers.BaseAbstractUnivariateRealSolver.DEFAULT_FUNCTION_VALUE_ACCURACY)==(org.apache.commons.math.analysis.solvers.BaseAbstractUnivariateRealSolver.this.functionValueAccuracy)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BracketingNthOrderBrentSolver

235c235,238
<                 targetY = -REDUCTION_FACTOR * yB;
---
>                 final int p = agingA - MAXIMAL_AGING;
>                 final double weightA = (1 << p) - 1;
>                 final double weightB = p + 1;
>                 targetY = (weightA * yA - weightB * REDUCTION_FACTOR * yB) / (weightA + weightB);
238c241,244
<                 targetY = -REDUCTION_FACTOR * yA;
---
>                 final int p = agingB - MAXIMAL_AGING;
>                 final double weightA = p + 1;
>                 final double weightB = (1 << p) - 1;
>                 targetY = (weightB * yB - weightA * REDUCTION_FACTOR * yA) / (weightA + weightB);


```

### Bug 49

- Ranking nopol: 12

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 12
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 539501ms
----PATCH FOUND----
org.apache.commons.math.linear.OpenMapRealVector:667: PRECONDITION (org.apache.commons.math.linear.OpenMapRealVector.this.epsilon)==(org.apache.commons.math.linear.OpenMapRealVector.DEFAULT_ZERO_TOLERANCE)
```

- IRL patch:

```
org.apache.commons.math.linear.OpenMapRealVector

345c345
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();
358c358
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();
370c370
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();
383c383
<         Iterator iter = res.entries.iterator();
---
>         Iterator iter = entries.iterator();


```

### Bug 50

- Ranking nopol: 6

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 6
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 930372ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BaseSecantSolver:186: CONDITIONAL (f0)<(-1)
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BaseSecantSolver

186,193c186
<                     if (x == x1) {
<                         final double delta = FastMath.max(rtol * FastMath.abs(x1),
<                                                           atol);
<                         // Update formula cannot make any progress: Update the
<                         // search interval.
<                         x0 = 0.5 * (x0 + x1 - delta);
<                         f0 = computeObjectiveValue(x0);
<                     }
---
>                     // Nothing.


```

### Bug 52

- Ranking nopol: 38

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 38
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 639778ms
----PATCH FOUND----
org.apache.commons.math.geometry.euclidean.threed.Rotation:369: CONDITIONAL (c)<=(alpha)
```

- IRL patch:

```
org.apache.commons.math.geometry.euclidean.threed.Rotation

316,319c316,319
<   double u1u1 = Vector3D.dotProduct(u1, u1);
<   double u2u2 = Vector3D.dotProduct(u2, u2);
<   double v1v1 = Vector3D.dotProduct(v1, v1);
<   double v2v2 = Vector3D.dotProduct(v2, v2);
---
>   double u1u1 = u1.getNormSq();
>   double u2u2 = u2.getNormSq();
>   double v1v1 = v1.getNormSq();
>   double v2v2 = v2.getNormSq();
324,331d323
<   double u1x = u1.getX();
<   double u1y = u1.getY();
<   double u1z = u1.getZ();
< 
<   double u2x = u2.getX();
<   double u2y = u2.getY();
<   double u2z = u2.getZ();
< 
333,341c325,329
<   double coeff = FastMath.sqrt (u1u1 / v1v1);
<   double v1x   = coeff * v1.getX();
<   double v1y   = coeff * v1.getY();
<   double v1z   = coeff * v1.getZ();
<   v1 = new Vector3D(v1x, v1y, v1z);
< 
<   // adjust v2 in order to have (u1|u2) = (v1|v2) and (v2'|v2') = (u2|u2)
<   double u1u2   = Vector3D.dotProduct(u1, u2);
<   double v1v2   = Vector3D.dotProduct(v1, v2);
---
>   v1 = new Vector3D(FastMath.sqrt(u1u1 / v1v1), v1);
> 
>   // adjust v2 in order to have (u1|u2) = (v1'|v2') and (v2'|v2') = (u2|u2)
>   double u1u2   = u1.dotProduct(u2);
>   double v1v2   = v1.dotProduct(v2);
346,353c334,336
<   double v2x    = alpha * v1x + beta * v2.getX();
<   double v2y    = alpha * v1y + beta * v2.getY();
<   double v2z    = alpha * v1z + beta * v2.getZ();
<   v2 = new Vector3D(v2x, v2y, v2z);
< 
<   // preliminary computation (we use explicit formulation instead
<   // of relying on the Vector3D class in order to avoid building lots
<   // of temporary objects)
---
>   v2 = new Vector3D(alpha, v1, beta, v2);
> 
>   // preliminary computation
356,370c339,346
<   double dx1 = v1x - u1.getX();
<   double dy1 = v1y - u1.getY();
<   double dz1 = v1z - u1.getZ();
<   double dx2 = v2x - u2.getX();
<   double dy2 = v2y - u2.getY();
<   double dz2 = v2z - u2.getZ();
<   Vector3D k = new Vector3D(dy1 * dz2 - dz1 * dy2,
<                             dz1 * dx2 - dx1 * dz2,
<                             dx1 * dy2 - dy1 * dx2);
<   double c = k.getX() * (u1y * u2z - u1z * u2y) +
<              k.getY() * (u1z * u2x - u1x * u2z) +
<              k.getZ() * (u1x * u2y - u1y * u2x);
< 
<   if (c == 0) {
<     // the (q1, q2, q3) vector is in the (u1, u2) plane
---
>   Vector3D v1Su1 = v1.subtract(u1);
>   Vector3D v2Su2 = v2.subtract(u2);
>   Vector3D k     = v1Su1.crossProduct(v2Su2);
>   Vector3D u3    = u1.crossProduct(u2);
>   double c       = k.dotProduct(u3);
>   final double inPlaneThreshold = 0.001;
>   if (c <= inPlaneThreshold * k.getNorm() * u3.getNorm()) {
>     // the (q1, q2, q3) vector is close to the (u1, u2) plane
372d347
<     Vector3D u3 = Vector3D.crossProduct(u1, u2);
374,399c349,358
<     double u3x  = u3.getX();
<     double u3y  = u3.getY();
<     double u3z  = u3.getZ();
<     double v3x  = v3.getX();
<     double v3y  = v3.getY();
<     double v3z  = v3.getZ();
< 
<     double dx3 = v3x - u3x;
<     double dy3 = v3y - u3y;
<     double dz3 = v3z - u3z;
<     k = new Vector3D(dy1 * dz3 - dz1 * dy3,
<                      dz1 * dx3 - dx1 * dz3,
<                      dx1 * dy3 - dy1 * dx3);
<     c = k.getX() * (u1y * u3z - u1z * u3y) +
<         k.getY() * (u1z * u3x - u1x * u3z) +
<         k.getZ() * (u1x * u3y - u1y * u3x);
< 
<     if (c == 0) {
<       // the (q1, q2, q3) vector is aligned with u1:
<       // we try (u2, u3) and (v2, v3)
<       k = new Vector3D(dy2 * dz3 - dz2 * dy3,
<                        dz2 * dx3 - dx2 * dz3,
<                        dx2 * dy3 - dy2 * dx3);
<       c = k.getX() * (u2y * u3z - u2z * u3y) +
<           k.getY() * (u2z * u3x - u2x * u3z) +
<           k.getZ() * (u2x * u3y - u2y * u3x);
---
>     Vector3D v3Su3 = v3.subtract(u3);
>     k = v1Su1.crossProduct(v3Su3);
>     Vector3D u2Prime = u1.crossProduct(u3);
>     c = k.dotProduct(u2Prime);
> 
>     if (c <= inPlaneThreshold * k.getNorm() * u2Prime.getNorm()) {
>       // the (q1, q2, q3) vector is also close to the (u1, u3) plane,
>       // it is almost aligned with u1: we try (u2, u3) and (v2, v3)
>       k = v2Su2.crossProduct(v3Su3);;
>       c = k.dotProduct(u2.crossProduct(u3));;
401c360
<       if (c == 0) {
---
>       if (c <= 0) {
430,431c389
<    c = Vector3D.dotProduct(k, k);
<   q0 = Vector3D.dotProduct(vRef, k) / (c + c);
---
>   q0 = vRef.dotProduct(k) / (2 * k.getNormSq());
455c413
<     double dot = Vector3D.dotProduct(u, v);
---
>     double dot = u.dotProduct(v);
470,472c428,431
<       q1 = coeff * (v.getY() * u.getZ() - v.getZ() * u.getY());
<       q2 = coeff * (v.getZ() * u.getX() - v.getX() * u.getZ());
<       q3 = coeff * (v.getX() * u.getY() - v.getY() * u.getX());
---
>       Vector3D q = v.crossProduct(u);
>       q1 = coeff * q.getX();
>       q2 = coeff * q.getY();
>       q3 = coeff * q.getZ();


```

### Bug 57

- Ranking nopol: 55

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 55
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 7824543ms
----PATCH FOUND----
org.apache.commons.math.stat.clustering.EuclideanIntegerPoint:86: PRECONDITION (1)<(otherPoint.length)
```

- IRL patch:

```
org.apache.commons.math.stat.clustering.KMeansPlusPlusClusterer

175c175
<             int sum = 0;
---
>             double sum = 0;


```

### Bug 69

- Ranking nopol: 22

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 22
Nb Statements with Angelic Value Found : 2
Nopol Execution time : 149763ms
----PATCH FOUND----
org.apache.commons.math.stat.correlation.PearsonsCorrelation:190: PRECONDITION ((1)-((-1)+(-1)))<=(nVars)
```

- IRL patch:

```
org.apache.commons.math.stat.correlation.PearsonsCorrelation

171c171
<                     out[i][j] = 2 * (1 - tDistribution.cumulativeProbability(t));
---
>                     out[i][j] = 2 * tDistribution.cumulativeProbability(-t);


```

### Bug 73

- Ranking nopol: 63

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 63
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 93268ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.UnivariateRealSolverImpl:225: CONDITIONAL ((initial)<=(lower))||((!((1)!=(lower)))&&((org.apache.commons.math.analysis.solvers.UnivariateRealSolverImpl.this.result)<(1)))
```

- IRL patch:

```
org.apache.commons.math.analysis.solvers.BrentSolver

34a35,39
>     /** Error message for non-bracketing interval. */
>     private static final String NON_BRACKETING_MESSAGE =
>         "function values at endpoints do not have different signs.  " +
>         "Endpoints: [{0}, {1}], Values: [{2}, {3}]";
> 
130a136,140
>         if (yMin * yMax > 0) {
>             throw MathRuntimeException.createIllegalArgumentException(
>                   NON_BRACKETING_MESSAGE, min, max, yMin, yMax);
>         }
> 
179,181c189
<                         "function values at endpoints do not have different signs.  " +
<                         "Endpoints: [{0}, {1}], Values: [{2}, {3}]",
<                         min, max, yMin, yMax);
---
>                         NON_BRACKETING_MESSAGE, min, max, yMin, yMax);


```

### Bug 78

- Ranking nopol: 70

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 70
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 130092ms
----PATCH FOUND----
org.apache.commons.math.analysis.solvers.BrentSolver:282: PRECONDITION (-1)<=(delta)
```

- IRL patch:

```
org.apache.commons.math.ode.events.EventState

190a191,210
>                     if (ga * gb > 0) {
>                         // this is a corner case:
>                         // - there was an event near ta,
>                         // - there is another event between ta and tb
>                         // - when ta was computed, convergence was reached on the "wrong side" of the interval
>                         // this implies that the real sign of ga is the same as gb, so we need to slightly
>                         // shift ta to make sure ga and gb get opposite signs and the solver won't complain
>                         // about bracketing
>                         final double epsilon = (forward ? 0.25 : -0.25) * convergence;
>                         for (int k = 0; (k < 4) && (ga * gb > 0); ++k) {
>                             ta += epsilon;
>                             interpolator.setInterpolatedTime(ta);
>                             ga = handler.g(ta, interpolator.getInterpolatedState());
>                         }
>                         if (ga * gb > 0) {
>                             // this should never happen
>                             throw MathRuntimeException.createInternalError(null);
>                         }
>                     }
>                          
209,218c229,231
<                     double root;
<                     try {
<                         root = (ta <= tb) ? solver.solve(f, ta, tb) : solver.solve(f, tb, ta);
<                     } catch (IllegalArgumentException iae) {
<                         // the interval did not really bracket a root
<                         root = Double.NaN;
<                     }
<                     if (Double.isNaN(root) ||
<                         ((Math.abs(root - ta) <= convergence) &&
<                          (Math.abs(root - previousEventTime) <= convergence))) {
---
>                     final double root = (ta <= tb) ? solver.solve(f, ta, tb) : solver.solve(f, tb, ta);
>                     if ((Math.abs(root - ta) <= convergence) &&
>                          (Math.abs(root - previousEventTime) <= convergence)) {


```

### Bug 79

- Ranking nopol: 70

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 70
Nb Statements with Angelic Value Found : 2
Nopol Execution time : 1432218ms
----PATCH FOUND----
org.apache.commons.math.util.MathUtils:1627: PRECONDITION (org.apache.commons.math.util.MathUtils.FACTORIALS!=null)&&(!((((org.apache.commons.math.util.MathUtils.FACTORIALS.length)+(org.apache.commons.math.util.MathUtils.FACTORIALS.length))<=((p1.length)-(dp)))||(((org.apache.commons.math.util.MathUtils.FACTORIALS.length)+(org.apache.commons.math.util.MathUtils.FACTORIALS.length))<(dp))))
```

- IRL patch:

```
org.apache.commons.math.util.MathUtils

1624c1624
<       int sum = 0;
---
>       double sum = 0;
1626c1626
<           final int dp = p1[i] - p2[i];
---
>           final double dp = p1[i] - p2[i];


```

### Bug 80

- Ranking nopol: 31

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 31
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 125753ms
----PATCH FOUND----
org.apache.commons.math.linear.EigenDecompositionImpl:1137: PRECONDITION org.apache.commons.math.linear.EigenDecompositionImpl.this.cachedD!=null
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

1135c1135
<             int j = 4 * n - 1;
---
>             int j = 4 * (n - 1);


```

### Bug 81

- Ranking nopol: 46

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 46
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 104191ms
----PATCH FOUND----
org.apache.commons.math.linear.EigenDecompositionImpl:1534: CONDITIONAL (org.apache.commons.math.linear.EigenDecompositionImpl.TOLERANCE)<=(org.apache.commons.math.linear.EigenDecompositionImpl.this.lowerSpectra)
```

- IRL patch:

```
org.apache.commons.math.linear.EigenDecompositionImpl

598,599c598,603
<         work[lowerStart + m - 1] = dCurrent - eCurrent;
<         work[upperStart + m - 1] = dCurrent + eCurrent;
---
>         final double lower = dCurrent - eCurrent;
>         work[lowerStart + m - 1] = lower;
>         lowerSpectra = Math.min(lowerSpectra, lower);
>         final double upper = dCurrent + eCurrent;
>         work[upperStart + m - 1] = upper;
>         upperSpectra = Math.max(upperSpectra, upper);
902,903c906,907
<                     for (int i = 4 * i0; i < 4 * n0 - 11; i += 4) {
<                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) &&
---
>                     for (int i = 4 * i0; i < 4 * n0 - 16; i += 4) {
>                         if ((work[i + 3] <= TOLERANCE_2 * work[i]) ||
1540c1544
<                 if (end - start > 2) {
---
>                 if (end - start > 3) {


```

### Bug 82

- Ranking nopol: 119

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 119
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 3694476ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexSolver:63: PRECONDITION (0)!=(minValue)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexSolver

80,82c80,83
<             double rhs = tableau.getEntry(i, tableau.getWidth() - 1);
<             if (MathUtils.compareTo(tableau.getEntry(i, col), 0, epsilon) >= 0) {
<                 double ratio = rhs / tableau.getEntry(i, col);
---
>             final double rhs = tableau.getEntry(i, tableau.getWidth() - 1);
>             final double entry = tableau.getEntry(i, col);
>             if (MathUtils.compareTo(entry, 0, epsilon) > 0) {
>                 final double ratio = rhs / entry;


```

### Bug 87

- Ranking nopol: 88

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 88
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 3685387ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexTableau:161: PRECONDITION (1)!=(org.apache.commons.math.optimization.linear.SimplexTableau.this.numSlackVariables)
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

275,276c275
<             if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
<                 if (row == null) {
---
>             if (MathUtils.equals(getEntry(i, col), 1.0, epsilon) && (row == null)) {
278c277
<                 } else {
---
>             } else if (!MathUtils.equals(getEntry(i, col), 0.0, epsilon)) {
282d280
<         }


```

### Bug 88

- Ranking nopol: 39

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 39
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 80261ms
----PATCH FOUND----
org.apache.commons.math.optimization.linear.SimplexTableau:352: PRECONDITION (org.apache.commons.math.optimization.linear.SimplexTableau.this.numSlackVariables)<(org.apache.commons.math.optimization.linear.SimplexTableau.this.constraints.size())
```

- IRL patch:

```
org.apache.commons.math.optimization.linear.SimplexTableau

326c326,329
<         double mostNegative = getDecisionVariableValue(getOriginalNumDecisionVariables());
---
>         Integer basicRow =
>             getBasicRow(getNumObjectiveFunctions() + getOriginalNumDecisionVariables());
>         double mostNegative = basicRow == null ? 0 : getEntry(basicRow, getRhsOffset());
>         Set<Integer> basicRows = new HashSet<Integer>();
327a331,337
>             basicRow = getBasicRow(getNumObjectiveFunctions() + i);
>             if (basicRows.contains(basicRow)) {
>                 // if multiple variables can take a given value 
>                 // then we choose the first and set the rest equal to 0
>                 coefficients[i] = 0;
>             } else {
>                 basicRows.add(basicRow);
329,352c339,340
<                 getDecisionVariableValue(i) - (restrictToNonNegative ? 0 : mostNegative); 
<         }
<         return new RealPointValuePair(coefficients, f.getValue(coefficients));
<     }
< 
<     /**
<      * Get the value of the given decision variable.  This is not the actual
<      * value as it is guaranteed to be >= 0 and thus must be corrected before
<      * being returned to the user.
<      * 
<      * @param decisionVariable The index of the decision variable
<      * @return The value of the given decision variable.
<      */
<     protected double getDecisionVariableValue(final int decisionVariable) {
<       int col = getNumObjectiveFunctions() + decisionVariable;  
<       Integer basicRow = getBasicRow(col);
<       if (basicRow == null) {
<           return 0;
<       }
<       // if there are multiple variables that can take the value on the RHS
<       // then we'll give the first variable that value
<       for (int i = getNumObjectiveFunctions(); i < col; i++) {
<           if (tableau.getEntry(basicRow, i) == 1) {
<               return 0;
---
>                     (basicRow == null ? 0 : getEntry(basicRow, getRhsOffset())) -
>                     (restrictToNonNegative ? 0 : mostNegative);
355c343
<       return getEntry(basicRow, getRhsOffset()); 
---
>         return new RealPointValuePair(coefficients, f.getValue(coefficients));


```

### Bug 97

- Ranking nopol: 61

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 61
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 73351ms
----PATCH FOUND----
org.apache.commons.math.analysis.BrentSolver:136: PRECONDITION (min)<=(1)
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 99

- Ranking nopol: 61

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 61
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 72932ms
----PATCH FOUND----
org.apache.commons.math.analysis.BrentSolver:136: PRECONDITION (min)<=(1)
```

- IRL patch:

```
org.apache.commons.math.analysis.BrentSolver

130a131,132
>         double ret = Double.NaN;
>         
135c137,147
<         if (yMin * yMax >= 0) {
---
>         double sign = yMin * yMax;
>         if (sign > 0) {
>             // check if either value is close to a zero
>             if (Math.abs(yMin) <= functionValueAccuracy) {
>                 setResult(min, 0);
>                 ret = min;
>             } else if (Math.abs(yMax) <= functionValueAccuracy) {
>                 setResult(max, 0);
>                 ret = max;
>             } else {
>                 // neither value is close to zero and min and max do not bracket root.
141c153
< 
---
>         } else if (sign < 0){
143c155,163
<         return solve(min, yMin, max, yMax, min, yMin);
---
>             ret = solve(min, yMin, max, yMax, min, yMin);
>         } else {
>             // either min or max is a root
>             if (yMin == 0.0) {
>                 ret = min;
>             } else {
>                 ret = max;
>             }
>         }
144a165
>         return ret;


```

### Bug 105

- Ranking nopol: 72

- Nopol patch:

```
----INFORMATION----
Nb Statements Analyzed : 72
Nb Statements with Angelic Value Found : 1
Nopol Execution time : 68625ms
----PATCH FOUND----
org.apache.commons.math.stat.regression.SimpleRegression:107: PRECONDITION (((y)<=(x))&&((y)<=(x)))||(!((1)<(x)))
```

- IRL patch:

```
org.apache.commons.math.stat.regression.SimpleRegression

264c264
<         return sumYY - sumXY * sumXY / sumXX;
---
>         return Math.max(0d, sumYY - sumXY * sumXY / sumXX);


```

