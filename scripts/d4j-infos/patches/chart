#!/bin/bash

for bug in `seq 1 26`
do

  echo "Chart ${bug} patches infos ..."

  exec 6<&1

  exec 1> ~/defects4j-nopol/logs/d4j-infos/patches/chart/chart_${bug}.stdout

  line=`grep -m 1 -n "List of modified sources:" ~/defects4j-nopol/logs/d4j-infos/projects/chart/chart_${bug}.stdout | cut -f 1 -d :`
  let "line++"
  modifiedSources=`tail -n +$line ~/defects4j-nopol/logs/d4j-infos/projects/chart/chart_${bug}.stdout | tac | tail -n +2 | cut -f 3 -d ' '`

  # < delete in buggy
  # > add in fix
  for modifiedSource in $modifiedSources
  do

    #TODO: Add patch lines number
    grep '^\d' logs/d4j-diffs/chart/chart_11.stdout | cut -f 1 -d c | cut -f 1 -d a | cut -f 1 -d d

    pathModifiedSource=`echo $modifiedSource | tr . /`
    pathModifiedSource="$pathModifiedSource.java"
    deleted=`diff -b ~/projects/chart/buggy/chart_${bug}/source/$pathModifiedSource ~/projects/chart/fix/chart_${bug}/source/$pathModifiedSource | grep '<' | wc -l`
    added=`diff -b ~/projects/chart/buggy/chart_${bug}/source/$pathModifiedSource ~/projects/chart/fix/chart_${bug}/source/$pathModifiedSource | grep '>' | wc -l`
    echo $modifiedSource
    echo ""
    echo "Total deleted lines: $deleted"
    echo "Total added lines: $added"
    diff=0
    let "diff=added-deleted"
    echo "Diff added/deleted: $diff"
    echo ""
    echo ""
  done

  exec 1<&6 6<&-

done

echo 'Done.'
