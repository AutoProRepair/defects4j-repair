#!/bin/bash

export PATH="~/defects4j-nopol/defects4j/framework/bin:$PATH"


###########################
########## BUGGY ##########
###########################

for bug in `seq 1 27`
do
  echo "Time ${bug} buggy"

  exec 6<&1
  exec 7<&2

  exec 1> ~/defects4j-nopol/results/d4j-tests/time/buggy/time_${bug}_buggy.stdout
  exec 2> ~/defects4j-nopol/results/d4j-tests/time/buggy/time_${bug}_buggy.stderr

  defects4j checkout -p Time -v ${bug}b -w /tmp/time_${bug}_buggy

  cd /tmp/time_${bug}_buggy/
  defects4j compile
  defects4j test
  cd /tmp/
  rm -rf time_${bug}_buggy/

  exec 1<&6 6<&-
  exec 2<&7 7<&-
done


###########################
########### FIX ###########
###########################

for bug in `seq 1 27`
do
  echo "Time ${bug} fix"

  exec 6<&1
  exec 7<&2

  exec 1> ~/defects4j-nopol/results/d4j-tests/time/fix/time_${bug}_fix.stdout
  exec 2> ~/defects4j-nopol/results/d4j-tests/time/fix/time_${bug}_fix.stderr

  defects4j checkout -p Time -v ${bug}f -w /tmp/time_${bug}_fix

  cd /tmp/time_${bug}_fix/
  defects4j compile
  defects4j test
  cd /tmp/
  rm -rf time_${bug}_fix/

  exec 1<&6 6<&-
  exec 2<&7 7<&-
done
