#!/bin/bash

cd ~/defects4j-nopol/logs/nopol-repair/angelic/condition/time/

echo '# Time - Nopol angelic condition repair' > README.md
echo "" >> README.md
echo '| #Bug | Nb Statements Analyzed | Nb Angelic Value Found | Exec. time | Patch Found |' >> README_tmp.md
echo '|------|---------------|--------------|------------|------------|' >> README_tmp.md

nbPatchFound=0

for bug in `seq 1 27`
do
  information=`grep "^----INFORMATION----" stdout/time_${bug}.stdout`

  if [[ $information ]]; then
    statement=`grep "^Nb Statements Analyzed" stdout/time_${bug}.stdout | cut -f 2 -d :`
    angelic=`grep "^Nb Statements with Angelic Value Found" stdout/time_${bug}.stdout | cut -f 2 -d :`
    execTime=`grep "^Nopol Execution time" stdout/time_${bug}.stdout | cut -f 2 -d :`
    patchFound=`grep "^----PATCH FOUND----" stdout/time_${bug}.stdout`

    if [[ $patchFound ]]; then
      patch="YES"
      let "nbPatchFound++"
    else
      patch="NO"
    fi

    echo "| $bug | $statement | $angelic | $execTime | $patch |" >> README_tmp.md
  else
    echo "| $bug | NONE | NONE | > 6h | NO |" >> README_tmp.md
  fi
done

echo "" >> README.md
echo "- Nb patch found: $nbPatchFound/27" >> README.md
echo "" >> README.md

cat README_tmp.md >> README.md
rm README_tmp.md

if [[ $nbPatchFound -gt 0 ]]; then
  echo "## Patches" >> README.md
  echo "" >> README.md

  for bug in `seq 1 27`
  do
    patchFound=`grep "^----PATCH FOUND----" stdout/time_${bug}.stdout`

    if [[ $patchFound ]]; then
      echo "### Bug $bug" >> README.md
      echo "" >> README.md

      echo '```' >> README.md
      cat stdout/time_${bug}.stdout >> README.md
      echo '```' >> README.md
    fi
  done
fi

echo 'Done.'
